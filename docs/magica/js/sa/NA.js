/*! todestrieb: Magical Girls Gallery Â© 2021 LiviaMedeiros */
'use strict';((M,N)=>{const O=["lm_click","lm_touch"];var w={},q={},D={},P=null,E=null,F={},x={},G={},g={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1};const H=a=>fetch("/magica/json/"+a+".json",{cache:"force-cache"}).then(b=>location.hostname.toLowerCase().startsWith(M)&&b.json()),Q=a=>Object.entries(a).forEach(([b,c])=>F[b]=URL.createObjectURL(new Blob([Uint8Array.from(atob(c),d=>d.charCodeAt(0))],
{type:"image/png"}))),ca=(a,b=!1)=>{a||(g.no_file=!0,a='{"data":{}}');try{G=JSON.parse(a)}catch(c){return I(c)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(g,("object"===typeof b?b:{})||{},G.adjustments||{});return JSON.stringify(G)},y=a=>$("body").toggleClass(["connecting"],a),J=(a,b=[],c=2,d=100)=>{a.font&&b.push("@font-face{font-family:'Open Sans';src:url('data:font/ttf;base64,"+String(a.font)+"');}");a.raw&&b.push(...a.raw);a.href&&$("<link/>",{rel:"stylesheet",type:"text/css",href:a.href}).appendTo("head");
(new Promise(f=>{const l=setInterval(()=>{var n=document.styleSheets[c];return n&&(clearInterval(l),f(n))},d)})).then(f=>b.forEach(l=>f.insertRule(l,f.cssRules.length)))},R=()=>$("body").removeClass(O).addClass([O[+/ios|android/i.test(navigator.userAgent)]]),da=a=>(a=a.originalEvent.state)&&a.chara&&a.card?S(a.chara,a.card):($("#mainContent").removeClass(["hide"]),$("#cardDetail").addClass(["hide"]),T("status")),r=a=>{$("body").addClass(["lm_warn"]);$("#loading").attr({title:"An error occured. You can try to reload the page."}).on("pointerup",
()=>location.reload());return console.warn(a),!1},I=a=>{$("body").addClass(["lm_error"]);$("#loading").attr({title:"An error occured. You can report about it."}).find("p").on("pointerup",()=>location.assign("https://github.com/"+N+"/"+M+"/issues"));return console.error(a.originalEvent),!1},U=a=>Object.entries(Object.assign(D,a)).forEach(([b,c])=>(c=F[c])?($("img[data-nativeimgkey="+b+"]").removeAttr("data-nativeimgkey data-src").attr({src:c}),$(".lm_ob[data-nativebgkey="+b+"]").removeClass(["lm_ob"]).removeAttr("data-nativebgkey data-src").css({backgroundImage:"url("+
c+")"})):r(b)),z=()=>{let a={};$("img[data-nativeimgkey]").each((b,{dataset:c})=>(b=c.nativeimgkey)&&!D[b]?a[b]=c.src:!0);$(".lm_ob[data-nativebgkey]").each((b,{dataset:c})=>(b=c.nativebgkey)&&!D[b]?a[b]=c.src:!0);if(Object.values(a).every(b=>b in F))return U(a);y(!0);Promise.all([...(new Set(Object.keys(a).filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>H("card_c_"+b.substr(5,4)))).then(b=>{b.forEach(Q);U(a);y(!1)}).catch(r)},V=(a,b)=>g.card_probability?Math.random()<g.card_probability:q[a]&&q[a].includes(b),
ea=a=>g.chara_probability?Math.random()<g.chara_probability:q[a]&&0<q[a].length,fa=({attributeId:a,name:b,id:c,title:d,kana:f})=>$("<div>",{"class":"lm_missing chara commonFrame4 se_decide "+a,title:b,data:{charaId:c,maxCardRank:0},append:[$("<div>",{"class":"nameWrap",append:[$("<span>",{"class":"att "+a}),$("<p>",{"class":"name",text:b,append:$("<span>",{"class":"title",text:d})}),$("<p>",{"class":"kana",text:f})]}),$("<div>",{"class":"charaIconWrap"})]}),t=(a,b,c="id")=>x[a].data.find(({[c]:d})=>
d==b),m=(a,b)=>({alt:"","data-nativeimgkey":a,"data-src":"resource/image_native/"+b+"/"+a+".png"}),K=(a,b)=>({["data-nat"+N.substr(1,2)+"ebgkey"]:a,"data-src":"resource/image_native/"+b+"/"+a+".png"}),ia=a=>{const b=ea(a.id);if(g.hide_missing&&!b)return!1;const c=fa(a);(w[a.id]=x.card.data.filter(d=>d.charaNo==a.id)).forEach(d=>{var f=d.rank;const l=$("<div>",{"class":"userCharaIcon "+d.attributeId+" "+f});V(d.charaNo,d.cardId)?(f=+f.split("RANK_")[1],f>c.data("maxCardRank")&&c.data({maxCardId:d.cardId,
maxCardRank:f}).removeClass(["lm_missing"]),c.attr({tabindex:"2"}),l.append(W(d))):l.append($("<span>",{"class":"closed"}));$(".charaIconWrap",c).append(l)});$("#charaWrapInner").append(b?c.on("pointerup",ha):c)},W=a=>[["att","att","attributeId"],["star","star","rank"],["rank","frame","rank"],[!1,"card","cardId","_f"],["bg","bg","attributeId"]].map(([b,c,d,f=""])=>(d=c+"_"+a[d].toString().toLowerCase()+f,b?$("<span>",{"class":"lm_ob "+b,...K(d,"card/frame")}):$("<img>",m(d,"card/image")))),ha=a=>
{if(!a.cancelable&&!a.isTrigger&&g.fix_scrollbug)return!0;a.preventDefault();const {charaId:b,maxCardId:c}=$(a.currentTarget).data();history.pushState({page:"mgirl",chara:b,card:c},"Magical Girl \u2116"+b);return S(b,c)},S=(a,b)=>{if(!ja(t("chara",a),t("card",b,"cardId")))return!1;z();$("#mainContent").addClass(["hide"]);$("#cardDetail").removeClass(["hide"])},X=a=>$("<div>",{"class":"detailWrap",append:[$("<p>",{"class":"name c_purple",text:a.name}),$("<div>",{"class":"common_line lc_beige"}),$("<p>",
{"class":"detail",text:a.shortDescription})]}),ja=(a,b)=>{if(!b)return!1;const c=P.clone(),{id:d,attributeId:f,title:l}=a,{cardId:n,rank:p,maxPieceSkillId1:Y,doppelMagiaId:Z}=b,aa=Array.from({length:5},(e,h)=>b["commandType"+(h+1)]);(e=>{$("#att",e).addClass([f.toLowerCase()]);$(".charaName",e).text(a.name).append(l&&$("<span>",{"class":"title ts_pink",text:l}))})($("#detailCardName",c));var u=m("card_"+n+"_c","card/image");$("#detailCardImage",c).append($("<div>",{"class":"lm_ob cardFrame "+p+" "+
f,...K("frame_"+f.toLowerCase()+"_"+p.toLowerCase(),"card/frame")}),$("<img>",{"class":"cardImg se_tabs",title:"Tap to zoom in",...u}),$("<img>",{"class":"zoomImg se_tabs",title:"Tap to zoom out",...u}),$("<span>",{"class":"moviePlayBtn se_tabs TE",title:"Transformation videos are disabled in this version"}));const ba=+p.split("RANK_")[1],[A,B,L]=["Status","Skill","Illust"].map(e=>$("#chara"+e,c));(e=>{$("img",e).attr(m("mini_"+b.miniCharaNo+"_s","mini/image"));$("#rare",e).removeClass().addClass([p]).append(Array(ba).fill("<span>").map(h=>
$(h)))})($("#cardDetailMiniChara",A));(e=>{$(".currentLv,.maxLv",$("#detailLv",e)).text([1,40,50,60,80,100][+p.split("RANK_")[1]]||1);$(".type>.tdStyle",e).text({BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType])})($(".statusWrap",A));(e=>({BALANCE:[1,1,1],ATTACK:[.98,1.03,.97],DEFENSE:[.97,.98,1.05],HP:[1.04,.97,.98],ATKDEF:[.99,1.02,1.01],ATKHP:[1.02,1.01,.99],DEFHP:[1.01,.99,1.02]})[b.growthType].map((h,
k)=>e.eq(k).text(+b[["hp","attack","defense"][k]]*(1+(g.keep_statbug?3:[0,2,2.2,2.4,2.6,3][+p.split("RANK_")[1]]||1)*h)|0)))($("#popupCharaStatus .c_red",A));[[".profileWrap>.detail",a.description],[".exProfile1>.tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+ba+" Illustrator"],[".selIllustrator",b.illustrator],[".selCharacterVoice",a.voiceActor]].forEach(([e,h])=>$(e,A).text(h));[["skill",".connect"],["magia",".magiaDetail"]].map(([e,h])=>{h=$(h,B);const {groupId:k,
name:C,shortDescription:v}=t(e,b[e+"Id"]);$("img",h).attr(m("icon_skill_"+k,"art"));$(".name",h).text(C);$(".detail",h).text(v)});$(".commandList",B).append(aa.map(e=>$("<li>",{"class":g.all_discs||e})));Y&&(u=t("pieceskill",Y),$(".command",B).after($("<div>",{"class":"commonFrame3 connect",append:[$("<p>",{"class":"common_title_frame",text:"EX Skill"}),$("<div>",{"class":g.keep_exbug?"flexbox":"flexBox",append:[$("<p>",{"class":"img",append:$("<img>",m("icon_skill_"+u.groupId,"art"))}),X(u)]})]})));
Z&&$(".magia",B).append($("<div>",{"class":"doppel doppelDetail",append:$("<div>",{"class":"flexBox",append:[$("<p>",{"class":"img doppel",append:[$("<img>",m("mini_"+b.doppelCharaNo+"_dd","mini/image")),$("<span>",{"class":"bg"})]}),X(t("magia",Z))]})}));(e=>$(".discPreview",L).append(aa.map(h=>$("<div>",{"class":"discWrap "+h,append:[$("<div>",{"class":"discText"}),e]}).clone())))($("<img>",m("card_"+n+"_d","card/image")));w[d].forEach((e,h)=>{var k=e.cardId;const C="mb_pink se_decide"+(k==n?" selected":
""),v="\u2605"+ +e.rank.split("RANK_")[1];k=V(d,k);$(".miniCharaBtn",L).append($("<p>",k?{"class":C,tabindex:"4",data:{commandtype:"card",cardarrindex:h}}:{"class":"mb_pink off"}).text(v));$(".selIllustIcon",L).append($("<div>",{"class":"cardIllustWrap"}).append($("<div>",k?{"class":"userCharaIcon "+e.attributeId,append:W(e)}:{"class":"offIcon"}),$("<p>",k?{"class":C,text:v,tabindex:"5",data:{cardarrindex:h}}:{"class":"mb_pink off",text:v})))});$("#cardDetail").data({charaId:d}).off().on("pointerup",
".collectionBack",()=>history.back()).on("pointerup","#detailCardImage>img",()=>$("#detailCardImage").toggleClass("zoom")).on("pointerup","#detailTab>li",T).on("pointerup",".moviePlayBtn",()=>setTimeout(e=>e.removeClass(),1500,$("#ready").addClass(["preNativeFadeIn"]))).on("pointerup",".cardIllustWrap>.mb_pink",ka).on("pointerup",".miniCharaBtn>.mb_pink",la).empty().append(c);return!0},T=a=>{a=a.currentTarget?$(a.currentTarget).attr("data-type"):a;$("#cardDetailWrap").removeClass().addClass([a]);
$("#detailTab>li").removeClass(["current"]).filter("[data-type="+a+"]").addClass(["current"])},ka=a=>{a.preventDefault();$(".cardIllustWrap>.selected").removeClass(["selected"]);const {cardId:b,rank:c,attributeId:d,illustrator:f}=w[$("#cardDetail").data("charaId")][$(a.currentTarget).addClass(["selected"]).data("cardarrindex")];a=$("#detailCardImage");$("img",a).attr(m("card_"+b+"_c","card/image"));$(".cardFrame",a).addClass(["lm_ob"]).attr(K("frame_"+d.toLowerCase()+"_"+c.toLowerCase(),"card/frame"));
$(".illustrator").text(f);$(".selIllustTitle").text("\u2605"+ +c.split("RANK_")[1]+" Illustrator:");z()},la=a=>{a.preventDefault();a=$(a.currentTarget);if(!a.is(".off,.selected")){$(".miniCharaBtn>.selected").removeClass("selected");a=a.addClass(["selected"]).data();var b=w[$("#cardDetail").data("charaId")][a.cardarrindex||0];$(".discPreview>.discWrap>img").attr(m(...("chara"==a.commandtype?["mini_"+b.miniCharaNo+"_d","mini/image"]:["card_"+b.cardId+"_d","card/image"])));z()}},ma=a=>{a.preventDefault();
$(".tabBtns>.current").removeClass(["current"]);$("#charaWrap").removeClass().addClass([$(a.currentTarget).addClass(["current"]).data("att").toLowerCase(),"commonFrame2"])};$(document).on("pointerdown",".TE",a=>$(a.currentTarget).not(".off,.current,.selected").addClass(["touch"])).on("pointermove pointerup",".TE",a=>$(a.currentTarget).removeClass(["touch"])).on("pointerdown","body",a=>setTimeout(b=>b.remove(),700,$("<div>",{"class":"commonEffect",css:{top:a.clientY-128+"px",left:a.clientX-128+"px"},
append:[$("<div>",{"class":"effect01"}),$("<div>",{"class":"effect02"}),$("<div>",{"class":"effect03"})]}).appendTo("body"))).on("keydown","[tabindex]",a=>("Enter"==a.key&&$(a.currentTarget).trigger("pointerup"),!0)).on("contextmenu",a=>(a.preventDefault(),document.documentElement.requestFullscreen().catch(r))).one("DOMContentLoaded",()=>{y(!0);R();$(window).on({resize:()=>E=E?clearTimeout(E):setTimeout(R,500),popstate:da,"error unhandledrejection":I});history.replaceState({page:"mgirls"},"Magical Girls Gallery");
const a=ca(...[/(?:^|; )gallery=([^;]*)/,/(?:^|; )adjustments=([^;]*)/].map(b=>(document.cookie.match(b)||[0,null])[1]));g.mirror&&$("body").addClass(["lm_rorrim"]);g.limit_height&&$("body").addClass(["lm_limit_height"]);g.fix_titlebug&&J({raw:["{margin-left:8px;}",'::before{content:"[";}','::after{content:"]";}'].map(b=>"#detailCardName>.charaName>.title"+b)});g.no_file&&$("<a/>",{id:"lm_use_setup",href:"/setup"}).appendTo("body");g.text_case&&$("body").addClass(["lm_to"+g.text_case]);g.font?H("font/"+
g.font).then(J).catch(r):J({href:"https://fonts.googleapis.com/css?family=Open+Sans:600"});Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(H)).then(b=>{var c=b.pop().data;try{x=JSON.parse([...c].reverse().join(""))}catch(d){I(d)}b.forEach(Q);q=JSON.parse(a).data||{};b=$("#charaWrapInner").css({display:"none"});P=$("#tmplCharaDetail").detach().removeAttr("id style");x.chara.data.forEach(ia);z();y(!1);b.css({display:"block"});$("#tabArea>.tabBtns>li").on("pointerup",ma)}).catch(r)})})
("todestrieb", "LiviaMedeiros");
