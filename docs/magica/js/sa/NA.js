/*! todestrieb: Magical Girls Gallery Â© 2021 LiviaMedeiros */
'use strict';((M,v)=>{var w={},t={},A={},N=null,B=null,C={},n={},D={},g={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1};const E=a=>fetch("/magica/json/"+a+".json",{cache:"force-cache"}).then(b=>location.hostname.toLowerCase().startsWith(M)&&b.json()),O=a=>Object.assign(C,a),Z=(a,b=!1)=>{a||(g.no_file=!0,a='{"data":{}}');try{D=JSON.parse(a)}catch(c){return F(c)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(g,
("object"===typeof b?b:{})||{},D.adjustments||{});return JSON.stringify(D)},x=a=>$("body")[a?"addClass":"removeClass"]("connecting"),G=(a,b=[],c=2,d=100)=>{a.font&&b.push("@font-face{font-family:'Open Sans';src:url('data:font/ttf;base64,"+String(a.font)+"');}");a.raw&&b.push(...a.raw);a.href&&$("<link/>",{rel:"stylesheet",type:"text/css",href:a.href}).appendTo("head");(new Promise(h=>{const m=setInterval(()=>{var p=document.styleSheets[c];return p&&(clearInterval(m),h(p))},d)})).then(h=>b.forEach(m=>
h.insertRule(m,h.cssRules.length)))},P=()=>$("body").removeClass("lm_touch lm_click").addClass(navigator.userAgent.match(/ios|android/i)?"lm_touch":"lm_click"),aa=a=>(a=a.originalEvent.state)&&a.h&&a.g?Q(a.h,a.g):($("#mainContent").removeClass("hide"),$("#cardDetail").addClass("hide"),R("status")),u=a=>{$("body").addClass("lm_warn");$("#loading").attr({title:"An error occured. You can try to reload the page."}).on("pointerup",()=>location.reload());return console.warn(a),!1},F=a=>{$("body").addClass("lm_error");
$("#loading").attr({title:"An error occured. You can report about it."}).find("p").on("pointerup",()=>location.assign("https://github.com/"+v+"/"+M+"/issues"));return console.error(a.originalEvent),!1},S=a=>Object.entries(Object.assign(A,a)).forEach(([b,c])=>(c=C[c])?($("[data-nativeimgkey="+b+"]").removeAttr("data-nativeimgkey").attr({src:"data:image/png;base64,"+c}),$("[data-nativebgkey="+b+"]").removeAttr("data-nativebgkey").css({backgroundImage:"url(data:image/png;base64,"+c+")"})):u(b)),y=()=>
{let a={};$("[data-nativeimgkey]").each((b,c)=>(b=c.dataset.nativeimgkey)&&!A[b]?a[b]=c.dataset.src:!0);$("[data-nativebgkey]").each((b,c)=>(b=c.dataset.nativebgkey)&&!A[b]?a[b]=c.dataset.src:!0);if(!Object.values(a).filter(b=>!(b in C)).length)return S(a);x(!0);Promise.all([...(new Set(Object.keys(a).filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>E("card_c_"+b.substr(5,4)))).then(b=>{b.forEach(O);S(a);x(!1)}).catch(u)},T=(a,b)=>g.card_probability?Math.random()<g.card_probability:t[a]&&t[a].includes(b),
ba=a=>g.chara_probability?Math.random()<g.chara_probability:t[a]&&0<t[a].length,ca=a=>$("<div>",{"class":"lm_missing chara commonFrame4 se_decide "+a.attributeId,title:a.name,data:{"chara-id":a.id,"max-card-rank":0},append:[$("<div>",{"class":"nameWrap",append:[$("<span>",{"class":"att "+a.attributeId}),$("<p>",{"class":"name",text:a.name,append:$("<span>",{"class":"title",text:a.title})}),$("<p>",{"class":"kana",text:a.kana})]}),$("<div>",{"class":"charaIconWrap"})]}),ea=a=>{const b=ba(a.id);if(g.hide_missing&&
!b)return!1;const c=ca(a);(w[a.id]=n.card.data.filter(d=>d.charaNo==a.id)).forEach(d=>{var h=d.rank;const m=$("<div>",{"class":"userCharaIcon "+d.attributeId+" "+h});T(d.charaNo,d.cardId)?(h=+h.split("RANK_")[1],h>c.data("max-card-rank")&&c.data({"max-card-id":d.cardId,"max-card-rank":h}).removeClass("lm_missing"),c.attr({tabindex:"2"}),m.append(U(d))):m.append($("<span>",{"class":"closed"}));$(".charaIconWrap",c).append(m)});$("#charaWrapInner").append(b?c.on("pointerup",da):c)},U=a=>[["att","att",
"attributeId"],["star","star","rank"],["rank","frame","rank"],[!1,"card","cardId","_f"],["bg","bg","attributeId"]].map(([b,c,d,h=""])=>(d=c+"_"+a[d].toString().toLowerCase()+h,b?$("<span>",{"class":b,"data-nativebgkey":d,"data-src":"resource/image_native/card/frame/"+d+".png"}):$("<img>",{"data-nativeimgkey":d,"data-src":"resource/image_native/card/image/"+d+".png"}))),da=a=>{if(!a.cancelable&&!a.isTrigger&&g.fix_scrollbug)return!0;a.preventDefault();var b=$(a.currentTarget);a=b.data("chara-id");
b=b.data("max-card-id");history.pushState({page:"mgirl",h:a,g:b},"Magical Girl \u2116"+a);return Q(a,b)},Q=(a,b)=>{if(!fa(n.chara.data.find(c=>c.id==a),n.card.data.find(c=>c.cardId==b)))return!1;y();$("#mainContent").addClass("hide");$("#cardDetail").removeClass("hide")},V=a=>$("<div>",{"class":"detailWrap",append:[$("<p>",{"class":"name c_purple",text:a.name}),$("<div>",{"class":"common_line lc_beige"}),$("<p>",{"class":"detail",text:a.shortDescription})]}),fa=(a,b)=>{if(!b)return!1;const c=N.clone(),
[d,h,m,p,r,W,X,Y]=[a.id,a.attributeId,a.title,b.cardId,b.rank,b.miniCharaNo,b.maxPieceSkillId1,b.doppelMagiaId];var l=$("#detailCardName",c);$("#att",l).addClass(h.toLowerCase());$(".charaName",l).text(a.name).append(m&&$("<span>",{"class":"title ts_pink",text:m}));l="frame_"+h.toLowerCase()+"_"+r.toLowerCase();var f={alt:"",["data-nat"+v.substr(1,2)+"eimgkey"]:"card_"+p+"_c","data-src":"resource/image_native/card/image/card_"+p+"_c.png"};$("#detailCardImage",c).append($("<div>",{"data-nativebgkey":l,
"data-src":"resource/image_native/card/frame/"+l+".png","class":"cardFrame "+r+" "+h}),$("<img>",{"class":"cardImg se_tabs",title:"Tap to zoom in"}).attr(f),$("<img>",{"class":"zoomImg se_tabs",title:"Tap to zoom out"}).attr(f),$("<span>",{"class":"moviePlayBtn se_tabs TE",title:"Transformation videos are disabled in this version"}));f=+r.split("RANK_")[1];const z=$("#charaStatus",c);l=$("#charaSkill",c);const H=$("#charaIllust",c);var k=$("#cardDetailMiniChara",z);$("img",k).attr({"data-nativeimgkey":"mini_"+
W+"_s","data-src":"resource/image_native/mini/image/mini_"+W+"_s.png"});k=$("#rare",k).removeClass().addClass(r);for(var I=f;0<I--;k.append($("<span>")));k=$(".statusWrap",z);$(".currentLv,.maxLv",$("#detailLv",k)).text([1,40,50,60,80,100][+r.split("RANK_")[1]]||1);$(".type>.tdStyle",k).text({BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType]);({BALANCE:[1,1,1],ATTACK:[.98,1.03,.97],DEFENSE:[.97,
.98,1.05],HP:[1.04,.97,.98],ATKDEF:[.99,1.02,1.01],ATKHP:[1.02,1.01,.99],DEFHP:[1.01,.99,1.02]})[b.growthType].map((e,q)=>$("#popupCharaStatus .c_red",z).eq(q).text(+b[["hp","attack","defense"][q]]*(1+(g.keep_statbug?3:[0,2,2.2,2.4,2.6,3][+r.split("RANK_")[1]]||1)*e)|0));[[".profileWrap>.detail",a.description],[".exProfile1>.tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+f+" Illustrator"],[".selIllustrator",b.illustrator],[".selCharacterVoice",a.voiceActor]].forEach(([e,
q])=>$(e,z).text(q));f=n.skill.data.find(e=>e.id==b.skillId);a=n.magia.data.find(e=>e.id==b.magiaId);k=$(".connect",l);I=$(".commandList",l);for(let e=0;5>e++;I.append($("<li>",{"class":g.all_discs||b["commandType"+e]})));$("img",k).attr({"data-nativeimgkey":"icon_skill_"+f.groupId,"data-src":"resource/image_native/art/icon_skill_"+f.groupId+".png"});$(".name",k).text(f.name);$(".detail",k).text(f.shortDescription);X&&(f=n.pieceskill.data.find(e=>e.id==X),k=f.groupId,$(".command",l).after($("<div>",
{"class":"commonFrame3 connect",append:[$("<p>",{"class":"common_title_frame",text:"EX Skill"}),$("<div>",{"class":g.keep_exbug?"flexbox":"flexBox",append:[$("<p>",{"class":"img",append:$("<img>",{"data-nativeimgkey":"icon_skill_"+k,"data-src":"resource/image_native/art/icon_skill_"+k+".png"})}),V(f)]})]})));f=$(".magiaDetail",l);$("img",f).attr({"data-nativeimgkey":"icon_skill_"+a.groupId,"data-src":"resource/image_native/art/icon_skill_"+a.groupId+".png"});$(".name",f).text(a.name);$(".detail",
f).text(a.shortDescription);Y&&(a=b.doppelCharaNo,$(".magia",l).append($("<div>",{"class":"doppel doppelDetail",append:$("<div>",{"class":"flexBox",append:[$("<p>",{"class":"img doppel",append:[$("<img>",{"data-nativeimgkey":"mini_"+a+"_dd","data-src":"resource/image_native/mini/image/mini_"+a+"_dd.png"}),$("<span>",{"class":"bg"})]}),V(n.magia.data.find(e=>e.id==Y))]})})));l=$("<img>",{"data-nativeimgkey":"card_"+p+"_d","data-src":"resource/image_native/card/image/card_"+p+"_d.png"});a=$(".discPreview",
H);for(f=0;5>f++;a.append($("<div>",{"class":"discWrap "+b["commandType"+f],append:[$("<div>",{"class":"discText"}),l]}).clone()));w[d].forEach((e,q)=>{const J=e.cardId,K="\u2605"+ +e.rank.split("RANK_")[1],L=T(d,J);$(".miniCharaBtn",H).append($("<p>",L?{"class":"mb_pink se_decide"+(J==p?" selected":""),tabindex:"4",data:{commandtype:"card",cardarrindex:q}}:{"class":"mb_pink off"}).text(K));$(".selIllustIcon",H).append($("<div>",{"class":"cardIllustWrap"}).append($("<div>",L?{"class":"userCharaIcon "+
e.attributeId,append:U(e)}:{"class":"offIcon"}),$("<p>",L?{"class":"mb_pink se_decide"+(J==p?" selected":""),text:K,tabindex:"5",data:{cardarrindex:q}}:{"class":"mb_pink off",text:K})))});$("#cardDetail").data({"chara-id":d}).off().on("pointerup",".collectionBack",()=>history.back()).on("pointerup","#detailCardImage>.cardImg,#detailCardImage>.zoomImg",()=>$("#detailCardImage").toggleClass("zoom")).on("pointerup","#detailTab>li",R).on("pointerup",".moviePlayBtn",()=>setTimeout(e=>e.removeClass(),1500,
$("#ready").addClass("preNativeFadeIn"))).on("pointerup",".cardIllustWrap>.mb_pink",ha).on("pointerup",".miniCharaBtn>.mb_pink",ia).empty().append(c);return!0},R=a=>{a=a.currentTarget?$(a.currentTarget).attr("name"):a;$("#cardDetailWrap").removeClass().addClass(a);$("#detailTab>li").removeClass("current").filter("[name="+a+"]").addClass("current")},ha=a=>{a.preventDefault();var b=$(a.currentTarget);a=w[$("#cardDetail").data("chara-id")][b.data("cardarrindex")];const c=a.cardId,d=a.rank;$(".cardIllustWrap>.selected").removeClass("selected");
b.addClass("selected");b="frame_"+a.attributeId.toLowerCase()+"_"+d.toLowerCase();const h=$("#detailCardImage");$(".cardImg,.zoomImg",h).attr({"data-nativeimgkey":"card_"+c+"_c","data-src":"resource/image_native/card/image/card_"+c+"_c.png"});$(".cardFrame",h).attr({["data-nat"+v.substr(1,2)+"ebgkey"]:b,"data-src":"resource/image_native/card/frame/"+b+".png"});$(".illustrator").first().text(a.illustrator);$(".selIllustTitle").first().text("\u2605"+ +d.split("RANK_")[1]+" Illustrator:");y()},ia=a=>
{a.preventDefault();a=$(a.currentTarget);if(!a.is(".off,.selected")){$(".miniCharaBtn>.selected").removeClass("selected");a.addClass("selected");var b=w[$("#cardDetail").data("chara-id")][a.data("cardarrindex")||0];"chara"==a.data("commandtype")?(a="mini/image/",b="mini_"+b.miniCharaNo+"_d"):(a="card/image/",b="card_"+b.cardId+"_d");$(".discPreview>.discWrap>img").attr({["data-nat"+v.substr(1,2)+"eimgkey"]:b,"data-src":"resource/image_native/"+a+b+".png"});y()}},ja=a=>{a.preventDefault();$(".tabBtns>.current").removeClass("current");
$("#charaWrap").removeClass().addClass($(a.currentTarget).addClass("current").data("att").toLowerCase()+" commonFrame2")};$(document).on("pointerdown",".TE",a=>$(a.currentTarget).not(".off,.current,.selected").addClass("touch")).on("pointermove pointerup",".TE",a=>$(a.currentTarget).removeClass("touch")).on("pointerdown","body",a=>setTimeout(b=>b.remove(),700,$("<div>",{"class":"commonEffect",css:{top:a.clientY-128+"px",left:a.clientX-128+"px"},append:[$("<div>",{"class":"effect01"}),$("<div>",{"class":"effect02"}),
$("<div>",{"class":"effect03"})]}).appendTo("body"))).on("keydown","[tabindex]",a=>("Enter"==a.key&&$(a.currentTarget).trigger("pointerup"),!0)).on("contextmenu",a=>(a.preventDefault(),document.documentElement.requestFullscreen().catch(u))).on("DOMContentLoaded",()=>{x(!0);P();$(window).on({resize:()=>B=B?clearTimeout(B):setTimeout(P,500),popstate:aa,"error unhandledrejection":F});history.replaceState({page:"mgirls"},"Magical Girls Gallery");const a=Z((document.cookie.match(/(?:^|; )gallery=([^;]*)/)||
[0,null])[1],(document.cookie.match(/(?:^|; )adjustments=([^;]*)/)||[0,null])[1]);g.mirror&&$("body").addClass("lm_rorrim");g.limit_height&&$("body").addClass("lm_limit_height");g.fix_titlebug&&G({raw:["{margin-left:8px;}",'::before{content:"[";}','::after{content:"]";}'].map(b=>"#detailCardName>.charaName>.title"+b)});g.no_file&&$("<a/>",{id:"lm_use_setup",href:"/setup"}).appendTo("body");g.text_case&&$("body").addClass("lm_to"+g.text_case);g.font?E("font/"+g.font).then(G).catch(u):G({href:"https://fonts.googleapis.com/css?family=Open+Sans:600"});
Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(E)).then(b=>{var c=b.pop().data;try{n=JSON.parse([...c].reverse().join(""))}catch(d){F(d)}b.forEach(O);t=JSON.parse(a).data||{};b=$("#charaWrapInner").css({display:"none"});N=$("#tmplCharaDetail").detach().removeAttr("id style");n.chara.data.forEach(ea);y();x(!1);b.css({display:"block"});$("#tabArea>.tabBtns>li").on("pointerup",ja)}).catch(u)})})
("todestrieb", "LiviaMedeiros");
