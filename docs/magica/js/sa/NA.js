/*! todestrieb: Magical Girls Gallery Â© 2021 LiviaMedeiros */
'use strict';((W,X)=>{var z=null,N={},l={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,show_kana:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1},Y=null,O=null;const A=new Map,P=new Map,G=new Map,H=new Map,Z=["lm_click","lm_touch"],Q=(a,b=189)=>{a=a.replace(/[^A-Za-z0-9\+\/]/g,"");for(var c=a.length,e=Math.ceil(3*c+1>>2),h=new Uint8Array(e),k,m=0,n=0,t=0;t<c;t++){k=t&3;let r=a.charCodeAt(t);m|=(64<r&&91>r?r-65:96<r&&123>r?r-71:47<r&&
58>r?r+4:43===r?62:47===r?63:0)<<6*(3-k);if(3===k||1===c-t){for(k=0;3>k&&n<e;k++,n++)h[n]=m>>>(16>>>k&24)&255^b;m=0}}return h},x=(a,b)=>{a.innerText=b;return a},p=(a,...b)=>{a.classList.add(...b);return a},w=(a,...b)=>{a.classList.remove(...(b.length?b:a.classList));return a},u=document.getElementById.bind(document),I=(a,b,c=document)=>c.querySelectorAll(a).forEach(b),f=(a,b=document)=>b.querySelector(a),d=(a="div",b={},c=[])=>{const {d:e={},c:h=[],g:k={},a:m=[],h:n={}}=b;(a=Object.assign(document.createElement(a),
k)).append(...m,...c);Object.assign(a.style,n);Object.assign(a.dataset,e);return p(a,...h)},R=a=>fetch(new URL("magica/json/"+a+".json",location.origin),{cache:"force-cache"}).then(b=>location.hostname.toLowerCase().startsWith(W)&&b.json()),aa=a=>Object.entries(a).forEach(([b,c])=>H.set(b,new URL(URL.createObjectURL(new Blob([Q(c,0)],{type:"image/png"}))))),la=(a,b=!1)=>{a||(l.no_file=!0,a='{"data":{}}');try{N=Object.freeze(JSON.parse(a))}catch(c){return S(c)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(l,
("object"===typeof b?b:{})||{},N.adjustments||{});return N},J=a=>document.documentElement.classList.toggle("connecting",a),ma=a=>{a=(new TextDecoder).decode(Q(a));try{z=Object.freeze(JSON.parse(a))}catch(b){S(b)}z.chara.forEach(({id:b})=>A.set(b,z.card.filter(c=>c.charaNo===b)))},T=(a,b=[],c=2,e=100)=>{a.font&&b.push("@font-face{font-family:'Open Sans';src:url("+URL.createObjectURL(new Blob([Q(a.font)],{type:"font/ttf"}))+");}");a.raw&&b.push(...a.raw);a.href&&document.head.append(d("link",{g:{rel:"stylesheet",
type:"text/css",href:a.href}}));(new Promise(h=>{const k=setInterval(()=>{var m=document.styleSheets[c];return m&&(clearInterval(k),h(m))},e)})).then(h=>b.forEach(k=>h.insertRule(k,h.cssRules.length)))},ba=()=>p(w(document.documentElement,...Z),Z[+/ios|android/i.test(navigator.userAgent)]),na=a=>(a=a.originalEvent?.state)&&a.chara&&a.card?ca(a):(w(u("mainContent"),"hide"),p(u("cardDetail"),"hide"),da("status")),B=a=>{p(document.documentElement,"lm_warn");Object.assign(u("loading")??{},{title:"An error occured. You can try to reload the page.",
onpointerup:()=>location.reload()});return console.warn(a),!1},S=a=>{p(document.documentElement,"lm_error");$("#loading").attr({title:"An error occured. You can report about it."}).find("p").on("pointerup",()=>location.assign(new URL(X+"/"+W+"/issues","https://github.com")));return console.error(a.originalEvent),!1},ea=a=>{a.forEach((b,c)=>G.set(c,b));G.forEach((b,c)=>(b=H.get(b))?($("img[data-nativeimgkey="+c+"]").removeAttr("data-nativeimgkey data-src").attr({src:b}),$(".lm_ob[data-nativebgkey="+
c+"]").removeClass(["lm_ob"]).removeAttr("data-nativebgkey data-src").css({backgroundImage:"url("+b+")"})):B(c))},K=(a=new Map)=>{I("img[data-nativeimgkey]",({dataset:{nativeimgkey:b,src:c}})=>b&&!G.has(b)&&a.set(b,c));I(".lm_ob[data-nativebgkey]",({dataset:{nativebgkey:b,src:c}})=>b&&!G.has(b)&&a.set(b,c));if([...a.values()].every(H.has.bind(H)))return ea(a);J(!0);Promise.all([...(new Set([...a.keys()].filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>R("card_c_"+b.substr(5,4)))).then(b=>{b.forEach(aa);
ea(a);J(!1)}).catch(B)},fa=(a,b)=>l.card_probability?Math.random()<l.card_probability:P.get(a)?.has(b),oa=({attributeId:a,name:b,id:c,title:e,kana:h})=>d("div",{c:["lm_missing","chara","commonFrame4","se_decide",a],g:{title:b},d:{charaId:c,maxCardRank:0}},[d("div",{c:["nameWrap"]},[d("span",{c:["att",a]}),d("p",{c:["name"],g:{textContent:b}},[d("span",{c:["title"],g:{textContent:e}})]),d("p",{c:["kana"],g:{textContent:h}})]),d("div",{c:["charaIconWrap"]})]),C=(a,b,c="id")=>z[a].find(({[c]:e})=>e===
b),pa=(a,b)=>({alt:"","data-nativeimgkey":a,"data-src":"resource/image_native/"+b+"/"+a+".png"}),y=(a,b)=>({nativeimgkey:a,src:"resource/image_native/"+b+"/"+a+".png"}),U=(a,b)=>({["nat"+X.substr(1,2)+"ebgkey"]:a,src:"resource/image_native/"+b+"/"+a+".png"}),ra=a=>{const b=a.id,c=l.chara_probability?Math.random()<l.chara_probability:P.get(b)?.size;if(l.hide_missing&&!c)return!1;const e=oa(a);A.get(b).forEach(h=>{const {id:k,rank:m}=h,n=d("div",{c:["userCharaIcon",h.attributeId,m]});if(fa(h.charaNo,
k)){const t=+m.split("RANK_")[1];t>+Object.assign(e,{tabIndex:"2"}).dataset.maxCardRank&&Object.assign(w(e,"lm_missing").dataset,{maxCardId:k,maxCardRank:t});n.append(...ha(h))}else n.append(d("span",{c:["closed"]}));f(".charaIconWrap",e).append(n)});c&&e.addEventListener("pointerup",qa);u("charaWrapInner").append(e)},ha=a=>[["att","att","attributeId"],["star","star","rank"],["rank","frame","rank"],[!1,"card","id","_f"],["bg","bg","attributeId"]].map(([b,c,e,h=""])=>(e=c+"_"+String(a[e]).toLowerCase()+
h,b?d("span",{c:["lm_ob",b],d:U(e,"card/frame")}):d("img",{g:{alt:""},d:y(e,"card/image")}))),qa=a=>{if(!a.cancelable&&a.isTrusted&&l.fix_scrollbug)return!0;a.preventDefault();const {charaId:b,maxCardId:c}=a.currentTarget.dataset;a={page:"mgirl",chara:+b,card:+c};history.pushState(a,"Magical Girl \u2116"+b);return ca(a)},ca=({chara:a,card:b})=>{if(!sa(C("chara",a),C("card",b)))return!1;K();p(u("mainContent"),"hide");w(u("cardDetail"),"hide")},ia=a=>d("div",{c:["detailWrap"]},[d("p",{c:["name","c_purple"],
g:{innerText:a.name}}),d("div",{c:["common_line","lc_beige"]}),d("p",{c:["detail"],g:{innerText:a.shortDescription}})]),sa=(a,b)=>{if(!b)return!1;const c=Y.clone()[0],{id:e,attributeId:h,title:k}=a,{id:m,rank:n,maxPieceSkillId:[t],doppelMagiaId:r,commandType:ja}=b;(g=>{p(f("#att",g),h.toLowerCase());x(f(".charaName",g),a.name).append(...(k?[d("span",{c:["title","ts_pink"],g:{innerText:k}})]:[]))})(f("#detailCardName",c));var D=y("card_"+m+"_c","card/image");f("#detailCardImage",c).append(d("div",
{c:["lm_ob","cardFrame",n,h],d:U("frame_"+h.toLowerCase()+"_"+n.toLowerCase(),"card/frame")}),d("img",{c:["cardImg","se_tabs"],g:{title:"Tap to zoom in"},d:D}),d("img",{c:["zoomImg","se_tabs"],g:{title:"Tap to zoom out"},d:D}),d("span",{c:["moviePlayBtn","se_tabs","TE"],g:{title:"Transformation videos are disabled in this version"}}));const ka=+n.split("RANK_")[1],[L,M,V]=["Status","Skill","Illust"].map(g=>f("#chara"+g,c));(g=>{Object.assign(f("img",g).dataset,y("mini_"+b.miniCharaNo+"_s","mini/image"));
p(f("#rare",g),n).append(...Array(ka).fill("span").map(q=>d(q)))})(f("#cardDetailMiniChara",L));(g=>{I(".currentLv,.maxLv",q=>x(q,[1,40,50,60,80,100][+n.split("RANK_")[1]]||1),f("#detailLv",g));x(f(".type>.tdStyle",g),{BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType])})(f(".statusWrap",L));(g=>({BALANCE:[1,1,1],ATTACK:[.98,1.03,.97],DEFENSE:[.97,.98,1.05],HP:[1.04,.97,.98],ATKDEF:[.99,1.02,
1.01],ATKHP:[1.02,1.01,.99],DEFHP:[1.01,.99,1.02]})[b.growthType].map((q,v)=>g.eq(v).text(+b[["hp","attack","defense"][v]]*(1+(l.keep_statbug?3:[0,2,2.2,2.4,2.6,3][+n.split("RANK_")[1]]||1)*q)|0)))($("#popupCharaStatus .c_red",L));[[".profileWrap>.detail",a.description],[".exProfile1>.tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+ka+" Illustrator"],[".selIllustrator",b.illustrator],[".selCharacterVoice",a.voiceActor]].forEach(([g,q])=>x(f(g,L),q));[["skill",".connect"],
["magia",".magiaDetail"]].map(([g,q])=>{q=f(q,M);const {groupId:v,name:E,shortDescription:F}=C(g,b[g+"Id"]);Object.assign(f("img",q).dataset,y("icon_skill_"+v,"art"));x(f(".name",q),E);x(f(".detail",q),F)});f(".commandList",M).append(...ja.map(g=>d("li",{c:[l.all_discs||g]})));f(".discPreview",V).append(...ja.map(g=>d("div",{c:["discWrap",g]},[d("div",{c:["discText"]}),d("img",{d:y("card_"+m+"_d","card/image")})])));t&&(D=C("pieceskill",t),f(".command",M).after(d("div",{c:["commonFrame3","connect"]},
[d("p",{c:["common_title_frame"],g:{innerText:"EX Skill"}}),d("div",{c:[l.keep_exbug?"flexbox":"flexBox"]}[d("p",{c:["img"]},[d("img",{d:y("icon_skill_"+D.groupId,"art")})]),ia(D)])])));r&&f(".magia",M).append(d("div",{c:["doppel","doppelDetail"]},[d("div",{c:["flexBox"]},[d("p",{c:["img","doppel"]},[d("img",{d:y("mini_"+b.doppelCharaNo+"_dd","mini/image")}),d("span",{c:["bg"]})]),ia(C("magia",r))])]));A.get(e).forEach((g,q)=>{var v=g.id;const E=["mb_pink","se_decide"];v===m&&E.push("selected");const F=
"\u2605"+ +g.rank.split("RANK_")[1];v=fa(e,v);f(".miniCharaBtn",V).append(x(d("p",v?{c:E,g:{tabndex:"4"},d:{commandtype:"card",cardarrindex:q}}:{c:["mb_pink","off"]}),F));f(".selIllustIcon",V).append(d("div",{c:["cardIllustWrap"]},[d("div",v?{c:["userCharaIcon",g.attributeId],a:ha(g)}:{c:["offIcon"]}),d("p",v?{c:E,g:{innerText:F,tabindex:"5"},d:{cardarrindex:q}}:{c:["mb_pink","off"],g:{innerText:F}})]))});$("#cardDetail").data({charaId:e}).off().on("pointerup",".collectionBack",()=>history.back()).on("pointerup",
"#detailCardImage>img",()=>u("detailCardImage").classList.toggle("zoom")).on("pointerup","#detailTab>li",da).on("pointerup",".moviePlayBtn",()=>setTimeout(g=>w(g),1500,p(u("ready"),"preNativeFadeIn"))).on("pointerup",".cardIllustWrap>.mb_pink",ta).on("pointerup",".miniCharaBtn>.mb_pink",ua).empty().append(c);return!0},da=a=>{a=a.currentTarget?.dataset?.type??a;p(w(u("cardDetailWrap")),a);$("#detailTab>li").removeClass(["current"]).filter("[data-type="+a+"]").addClass(["current"])},ta=a=>{a.preventDefault();
w(f(".cardIllustWrap>.selected"),"selected");const {id:b,rank:c,attributeId:e,illustrator:h}=A.get($("#cardDetail").data("charaId"))[$(a.currentTarget).addClass(["selected"]).data("cardarrindex")];(k=>{I("img",m=>Object.assign(m.dataset,y("card_"+b+"_c","card/image")),k);Object.assign(p(f(".cardFrame",k),"lm_ob").dataset,U("frame_"+e.toLowerCase()+"_"+c.toLowerCase(),"card/frame"))})(u("detailCardImage"));x(f(".illustrator"),h);x(f(".selIllustTitle"),"\u2605"+ +c.split("RANK_")[1]+" Illustrator:");
K()},ua=a=>{a.preventDefault();const b=a.currentTarget;if(!["off","selected"].some(e=>b.classList.contains(e))){w(f(".miniCharaBtn>.selected"),"selected");a=p(b,"selected").dataset;var c=A.get($("#cardDetail").data("charaId"))[a.cardarrindex||0];$(".discPreview>.discWrap>img").attr(pa(...("chara"===a.commandtype?["mini_"+c.miniCharaNo+"_d","mini/image"]:["card_"+c.id+"_d","card/image"])));K()}},va=a=>{a.preventDefault();w(f(".tabBtns>.current"),"current");$("#charaWrap").removeClass().addClass([$(a.currentTarget).addClass(["current"]).data("att").toLowerCase(),
"commonFrame2"])};$(document).on("pointerdown",".TE",({currentTarget:a})=>$(a).not(".off,.current,.selected").addClass(["touch"])).on("pointermove pointerup",".TE",({currentTarget:a})=>w(a,"touch")).on("pointerdown","body",a=>setTimeout(b=>b.remove(),700,(b=>document.body.appendChild(d("div",{c:["commonEffect"],h:{top:b.clientY-128+"px",left:b.clientX-128+"px"}},Array.from({length:3},(c,e)=>d("div",{c:["effect0"+(e+1)]})))))(a))).on("keydown","[tabindex]",a=>("Enter"===a.key&&$(a.currentTarget).trigger("pointerup"),
!0)).on("contextmenu",a=>(a.preventDefault(),document.documentElement.requestFullscreen().catch(B))).one("DOMContentLoaded",()=>{J(!0);ba();$(window).on({resize:()=>O=O?clearTimeout(O):setTimeout(ba,500),popstate:na,"error unhandledrejection":S});history.replaceState({page:"mgirls"},"Magical Girls Gallery");const a=la(...["gallery","adjustments"].map(b=>document.cookie.match(new RegExp("(?:^|;)\\s*"+b+"\\s*=\\s*([^;]*)"))?.pop()||null));l.mirror&&p(document.documentElement,"lm_rorrim");l.limit_height&&
p(document.documentElement,"lm_limit_height");l.fix_titlebug&&T({raw:["{margin-left:8px;}",'::before{content:"[";}','::after{content:"]";}'].map(b=>"#detailCardName>.charaName>.title"+b)});l.no_file&&document.body.append(d("a",{g:{id:"lm_use_setup",href:new URL("setup",location.origin)}}));l.text_case&&p(document.documentElement,"lm_to"+l.text_case);l.show_kana&&p(document.documentElement,"lm_kana");l.font?R("font/"+l.font).then(T).catch(B):T({href:new URL("css?family=Open+Sans:600","https://fonts.googleapis.com")});
Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(R)).then(b=>{ma(b.pop().data);b.forEach(aa);Object.entries(a.data).forEach(([c,e])=>P.set(+c,new Set(e.map(Number))));b=u("charaWrapInner");b.style.display="none";Y=$($("#tmplCharaDetail").detach()[0].content);z.chara.forEach(ra);K();J(!1);b.style.display="block";$("#tabArea>.tabBtns>li").on("pointerup",va)}).catch(B)})})
("todestrieb", "LiviaMedeiros");
