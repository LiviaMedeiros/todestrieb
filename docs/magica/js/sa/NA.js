/*! todestrieb: Magical Girls Gallery Â© 2021-2022 LiviaMedeiros */
'use strict';((Ea,Fa)=>{const [u,Ga,kb,lb,mb,Ha,c,f,ma,q,k,v,na,nb,Ia,w,oa,l,t,Ja,x,Ka,z,pa,r,E,S,ca,qa,T,ra,sa,La,Ma,Na,Oa,U,F,H,I,Pa,m,A,G,O,Qa,J,K,Ra,da,Sa,L,M,B,P,N,Ta,Ua,V,ta,Va,ea,W,X]="pointerup;pointerdown;pointermove pointerup;keydown;contextmenu;resource/image_native/;class;append;appendTo;data;text;title;css;after;find;attr;removeAttr;addClass;removeClass;toggleClass;body;originalEvent;currentTarget;tabindex;on;toLowerCase;preventDefault;card_;mini_;card/image;card/frame;mini/image;maxCardId;maxCardRank;charaNo;miniCharaNo;charaId;cardId;rank;attributeId;groupId;<div>;<p>;<span>;<img>;.png;id;name;kana;cardarrindex;commandtype;chara;card;selected;current;img;chara_probability;card_probability;att;bg;art;hide;mb_pink;off".split(";"),
Wa=["lm_click","lm_touch"];var [fa,Y,ua,Xa,va]=[{},{},{},null,null],wa={},ha={},xa={},n={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1};const ya=a=>fetch("/magica/json/"+a+".json",{cache:"force-cache"}).then(b=>location.hostname[E]().startsWith(Ea)&&b.json()),Ya=a=>Object.assign(wa,a),ob=(a,b=!1)=>{a||(n.no_file=!0,a='{"data":{}}');try{xa=JSON.parse(a)}catch(d){return za(d)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(n,
("object"===typeof b?b:{})||{},xa.adjustments||{});return JSON.stringify(xa)},ia=a=>$(x)[Ja](["connecting"],a),Aa=(a,b=[],d=2,g=100)=>{a.font&&b.push("@font-face{font-family:'Open Sans';src:url('data:font/ttf;base64,"+String(a.font)+"');}");a.raw&&b.push(...a.raw);if(a.href)$("<link/>",{rel:"stylesheet",type:"text/css",href:a.href})[ma]("head");(new Promise(h=>{const y=setInterval(()=>{var Q=document.styleSheets[d];return Q&&(clearInterval(y),h(Q))},g)})).then(h=>b.forEach(y=>h.insertRule(y,h.cssRules.length)))},
Za=()=>$(x)[t](Wa)[l]([Wa[+/ios|android/i.test(navigator.userAgent)]]),pb=a=>(a=a[Ka].state)&&a[L]&&a[M]?$a(a[L],a[M]):($("#mainContent")[t]([ea]),$("#cardDetail")[l]([ea]),ab("status")),Z=a=>{$(x)[l](["lm_warn"]);$("#loading")[w]({[v]:"An error occured. You can try to reload the page."})[r](u,()=>location.reload());return console.warn(a),!1},za=a=>{$(x)[l](["lm_error"]);$("#loading")[w]({[v]:"An error occured. You can report about it."})[Ia]("p")[r](u,()=>location.assign("https://github.com/"+Fa+
"/"+Ea+"/issues"));return console.error(a[Ka]),!1},bb=a=>Object.entries(Object.assign(ua,a)).forEach(([b,d])=>(d=wa[d])?($('img[data-nativeimgkey="'+b+'"]')[oa]("data-nativeimgkey")[w]({src:"data:image/png;base64,"+d}),$('.lm_ob[data-nativebgkey="'+b+'"]')[t](["lm_ob"])[oa]("data-nativebgkey")[na]({backgroundImage:"url(data:image/png;base64,"+d+")"})):Z(b)),ja=()=>{let a={};$("img[data-nativeimgkey]").each((b,{dataset:d})=>(b=d.nativeimgkey)&&!ua[b]?a[b]=d.src:!0);$(".lm_ob[data-nativebgkey]").each((b,
{dataset:d})=>(b=d.nativebgkey)&&!ua[b]?a[b]=d.src:!0);if(!Object.values(a).filter(b=>!(b in wa)).length)return bb(a);ia(!0);Promise.all([...(new Set(Object.keys(a).filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>ya("card_c_"+b.substr(5,4)))).then(b=>{b.forEach(Ya);bb(a);ia(!1)}).catch(Z)},cb=(a,b)=>n[Ua]?Math.random()<n[Ua]:Y[a]&&Y[a].includes(b),qb=a=>n[Ta]?Math.random()<n[Ta]:Y[a]&&0<Y[a].length,rb=({[I]:a,[K]:b,[J]:d,[v]:g,[Ra]:h})=>$(m,{[c]:"lm_missing chara commonFrame4 se_decide "+a,[v]:b,[q]:{[U]:d,
g:0},[f]:[$(m,{[c]:"nameWrap",[f]:[$(G,{[c]:V+" "+a}),$(A,{[c]:K,[k]:b,[f]:$(G,{[c]:v,[k]:g})}),$(A,{[c]:Ra,[k]:h})]}),$(m,{[c]:"charaIconWrap"})]}),aa=(a,b,d=J)=>ha[a][q][Ia](({[d]:g})=>g==b),C=(a,b)=>({alt:"","data-nativeimgkey":a,"data-src":Ha+b+"/"+a+Qa}),Ba=(a,b)=>({["data-nat"+Fa.substr(1,2)+"ebgkey"]:a,"data-src":Ha+b+"/"+a+Qa}),tb=a=>{const b=qb(a[J]);if(n.hide_missing&&!b)return!1;const d=rb(a);(fa[a[J]]=ha[M][q].filter(g=>g[Na]==a[J])).forEach(g=>{var h=g[H];const y=$(m,{[c]:"userCharaIcon "+
g[I]+" "+h});if(cb(g[Na],g[F])){h=+h.split("RANK_")[1];if(h>d[q](Ma))d[q]({[La]:g[F],[Ma]:h})[t](["lm_missing"]);d[w]({[pa]:"2"});y[f](db(g))}else y[f]($(G,{[c]:"closed"}));$(".charaIconWrap",d)[f](y)});$("#charaWrapInner")[f](b?d[r](u,sb):d)},db=a=>[[V,V,I],["star","star",H],[H,"frame",H],[!1,M,F,"_f"],[ta,ta,I]].map(([b,d,g,h=""])=>(g=d+"_"+a[g].toString()[E]()+h,b?$(G,{[c]:"lm_ob "+b,...Ba(g,ra)}):$(O,C(g,T)))),eb=a=>$(m,{[c]:"detailWrap",[f]:[$(A,{[c]:K+" c_purple",[k]:a[K]}),$(m,{[c]:"common_line lc_beige"}),
$(A,{[c]:"detail",[k]:a.shortDescription})]}),sb=a=>{if(!a.cancelable&&!a.isTrigger&&n.fix_scrollbug)return!0;a[S]();const {[U]:b,[La]:d}=$(a[z])[q]();history.pushState({page:"mgirl",[L]:b,[M]:d},"Magical Girl \u2116"+b);return $a(b,d)},$a=(a,b)=>{if(!ub(aa(L,a),aa(M,b,F)))return!1;ja();$("#mainContent")[l]([ea]);$("#cardDetail")[t]([ea])},ub=(a,b)=>{if(!b)return!1;const d=Xa.clone(),{[J]:g,[I]:h,[v]:y}=a,{[F]:Q,[H]:R,maxPieceSkillId1:fb,doppelMagiaId:gb}=b,hb=Array.from({length:5},(e,p)=>b["commandType"+
(p+1)]);(e=>{$("#"+V,e)[l]([h[E]()]);$(".charaName",e)[k](a[K])[f](y&&$(G,{[c]:v+" ts_pink",[k]:y}))})($("#detailCardName",d));var ba=C(ca+Q+"_c",T);$("#detailCardImage",d)[f]($(m,{[c]:"lm_ob cardFrame "+R+" "+h,...Ba("frame_"+h[E]()+"_"+R[E](),ra)}),$(O,{[c]:"cardImg se_tabs",[v]:"Tap to zoom in",...ba}),$(O,{[c]:"zoomImg se_tabs",[v]:"Tap to zoom out",...ba}),$(G,{[c]:"moviePlayBtn se_tabs TE",[v]:"Transformation videos are disabled in this version"}));const ib=+R.split("RANK_")[1],[ka,la,Ca]=["Status",
"Skill","Illust"].map(e=>$("#"+L+e,d));(e=>{$(N,e)[w](C(qa+b[Oa]+"_s",sa));$("#rare",e)[t]()[l]([R])[f](Array(ib).fill(G).map(p=>$(p)))})($("#cardDetailMiniChara",ka));(e=>{$(".currentLv,.maxLv",$("#detailLv",e))[k]([1,40,50,60,80,100][+R.split("RANK_")[1]]||1);$(".type>.tdStyle",e)[k]({BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType])})($(".statusWrap",ka));(e=>({BALANCE:[1,1,1],ATTACK:[.98,
1.03,.97],DEFENSE:[.97,.98,1.05],HP:[1.04,.97,.98],ATKDEF:[.99,1.02,1.01],ATKHP:[1.02,1.01,.99],DEFHP:[1.01,.99,1.02]})[b.growthType].map((p,D)=>e.eq(D)[k](+b[["hp","attack","defense"][D]]*(1+(n.keep_statbug?3:[0,2,2.2,2.4,2.6,3][+R.split("RANK_")[1]]||1)*p)|0)))($("#popupCharaStatus .c_red",ka));[[".profileWrap>.detail",a.description],[".exProfile1>.tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+ib+" Illustrator"],[".selIllustrator",b.illustrator],[".selCharacterVoice",
a.voiceActor]].forEach(([e,p])=>$(e,ka)[k](p));[["skill",".connect"],["magia",".magiaDetail"]].map(([e,p])=>{p=$(p,la);e=aa(e,b[e+"Id"]);$(N,p)[w](C("icon_skill_"+e[Pa],Va));$("."+K,p)[k](e[K]);$(".detail",p)[k](e.shortDescription)});$(".commandList",la)[f](hb.map(e=>$("<li>",{[c]:n.all_discs||e})));fb&&(ba=aa("pieceskill",fb),$(".command",la)[nb]($(m,{[c]:"commonFrame3 connect",[f]:[$(A,{[c]:"common_title_frame",[k]:"EX Skill"}),$(m,{[c]:n.keep_exbug?"flexbox":"flexBox",[f]:[$(A,{[c]:N,[f]:$(O,C("icon_skill_"+
ba[Pa],Va))}),eb(ba)]})]})));if(gb)$(".magia",la)[f]($(m,{[c]:"doppel doppelDetail",[f]:$(m,{[c]:"flexBox",[f]:[$(A,{[c]:N+" doppel",[f]:[$(O,C(qa+b.doppelCharaNo+"_dd",sa)),$(G,{[c]:ta})]}),eb(aa("magia",gb))]})}));(e=>$(".discPreview",Ca)[f](hb.map(p=>$(m,{[c]:"discWrap "+p,[f]:[$(m,{[c]:"discText"}),e]}).clone())))($(O,C(ca+Q+"_d",T)));fa[g].forEach((e,p)=>{var D=e[F];const jb=W+" se_decide"+(D==Q?" "+B:""),Da="\u2605"+ +e[H].split("RANK_")[1];D=cb(g,D);$(".miniCharaBtn",Ca)[f]($(A,D?{[c]:jb,[pa]:"4",
[q]:{[Sa]:M,[da]:p}}:{[c]:W+" "+X})[k](Da));$(".selIllustIcon",Ca)[f]($(m,{[c]:"cardIllustWrap"})[f]($(m,D?{[c]:"userCharaIcon "+e[I],[f]:db(e)}:{[c]:"offIcon"}),$(A,D?{[c]:jb,[k]:Da,[pa]:"5",[q]:{[da]:p}}:{[c]:W+" "+X,[k]:Da})))});$("#cardDetail")[q]({[U]:g})[X]()[r](u,".collectionBack",()=>history.back())[r](u,"#detailCardImage>"+N,()=>$("#detailCardImage")[Ja]("zoom"))[r](u,"#detailTab>li",ab)[r](u,".moviePlayBtn",()=>setTimeout(e=>e[t](),1500,$("#ready")[l](["preNativeFadeIn"])))[r](u,".cardIllustWrap>."+
W,vb)[r](u,".miniCharaBtn>."+W,wb).empty()[f](d);return!0},ab=a=>{a=a[z]?$(a[z])[w]("data-type"):a;$("#cardDetailWrap")[t]()[l]([a]);$("#detailTab>li")[t]([P]).filter('[data-type="'+a+'"]')[l]([P])},vb=a=>{a[S]();$(".cardIllustWrap>."+B)[t]([B]);const {[F]:b,[H]:d,[I]:g,illustrator:h}=fa[$("#cardDetail")[q](U)][$(a[z])[l]([B])[q](da)];a=$("#detailCardImage");$(N,a)[w](C(ca+b+"_c",T));$(".cardFrame",a)[l](["lm_ob"])[w](Ba("frame_"+g[E]()+"_"+d[E](),ra));$(".illustrator")[k](h);$(".selIllustTitle")[k]("\u2605"+
+d.split("RANK_")[1]+" Illustrator:");ja()},wb=a=>{a[S]();a=$(a[z]);if(!a.is("."+X+",."+B)){$(".miniCharaBtn>."+B)[t]([B]);a=a[l]([B])[q]();var b=fa[$("#cardDetail")[q](U)][a[da]||0];$(".discPreview>.discWrap>"+N)[w](C(...(a[Sa]==L?[qa+b[Oa]+"_d",sa]:[ca+b[F]+"_d",T])));ja()}},xb=a=>{a[S]();$(".tabBtns>."+P)[t]([P]);$("#charaWrap")[t]()[l]([$(a[z])[l]([P])[q](V)[E](),"commonFrame2"])};$(document)[r](Ga,".TE",a=>$(a[z]).not("."+X+",."+P+",."+B)[l](["touch"]))[r](kb,".TE",a=>$(a[z])[t](["touch"]))[r](Ga,
x,a=>setTimeout(b=>b.remove(),700,$(m,{[c]:"commonEffect",css:{top:a.clientY-128+"px",left:a.clientX-128+"px"},[f]:[$(m,{[c]:"effect01"}),$(m,{[c]:"effect02"}),$(m,{[c]:"effect03"})]})[ma](x)))[r](lb,"[tabindex]",a=>("Enter"==a.key&&$(a[z]).trigger(u),!0))[r](mb,a=>(a[S](),document.documentElement.requestFullscreen().catch(Z))).one("DOMContentLoaded",()=>{ia(!0);Za();$(window)[r]({resize:()=>va=va?clearTimeout(va):setTimeout(Za,500),popstate:pb,"error unhandledrejection":za});history.replaceState({page:"mgirls"},
"Magical Girls Gallery");const a=ob(...[/(?:^|; )gallery=([^;]*)/,/(?:^|; )adjustments=([^;]*)/].map(b=>(document.cookie.match(b)||[0,null])[1]));if(n.mirror)$(x)[l](["lm_rorrim"]);if(n.limit_height)$(x)[l](["lm_limit_height"]);n.fix_titlebug&&Aa({raw:["{margin-left:8px;}",'::before{content:"[";}','::after{content:"]";}'].map(b=>"#detailCardName>.charaName>.title"+b)});if(n.no_file)$("<a/>",{[J]:"lm_use_setup",href:"/setup"})[ma](x);if(n.text_case)$(x)[l](["lm_to"+n.text_case]);n.font?ya("font/"+
n.font).then(Aa).catch(Z):Aa({href:"https://fonts.googleapis.com/css?family=Open+Sans:600"});Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(ya)).then(b=>{var d=b.pop()[q];try{ha=JSON.parse([...d].reverse().join(""))}catch(g){za(g)}b.forEach(Ya);Y=JSON.parse(a)[q]||{};b=$("#charaWrapInner")[na]({display:"none"});Xa=$("#tmplCharaDetail").detach()[oa]("id style");ha[L][q].forEach(tb);ja();ia(!1);b[na]({display:"block"});$("#tabArea>.tabBtns>li")[r](u,xb)}).catch(Z)})})
("todestrieb", "LiviaMedeiros");
