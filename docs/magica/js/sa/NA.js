/*! todestrieb: Magical Girls Gallery Â© 2021 LiviaMedeiros */
'use strict';((ba,ca)=>{var G=null,S={},n={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,show_kana:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1},da=null,T=null;const z=document.documentElement,[H,U,N,O]=Array.from({length:4},()=>new Map);class qa{i=new Map;h=0;j(...a){const b=this.h++,c=new Promise((d,f)=>this.i.set(b,{resolve:d,reject:f}));this.l.postMessage({$:a,h:b});return c}constructor(a){(this.l=new Worker(URL.createObjectURL(new Blob(["const f=",
a,";onmessage=({data})=>{try{data.resolve=f(...data.$);}catch(e){data.reject=e;}self.postMessage(data,[data.resolve]);};"],{type:"application/javascript"})))).addEventListener("message",({data:b})=>{const c=this.i.get(b.h);this.i.delete(b.h);return b.reject?c.reject(b.reject):c.resolve(b.resolve)})}}const V=new qa((a,b=189)=>{a=a.replace(/[^A-Za-z0-9\+\/]/g,"");for(var c=a.length,d=Math.ceil(3*c+1>>2),f=new Uint8Array(d),h,l=0,t=0,p=0;p<c;p++){h=p&3;let v=a.charCodeAt(p);l|=(64<v&&91>v?v-65:96<
v&&123>v?v-71:47<v&&58>v?v+4:43===v?62:47===v?63:0)<<6*(3-h);if(3===h||1===c-p){for(h=0;3>h&&t<d;h++,t++)f[t]=l>>>(16>>>h&24)^b;l=0}}return f.buffer}),ea=a=>Promise.all(Object.entries(a).map(([b,c])=>V.j(c,0).then(d=>O.set(b,new URL(URL.createObjectURL(new Blob([d],{type:"image/png"}))))))),ra=a=>V.j(a).then(b=>{b=(new TextDecoder).decode(b);try{G=Object.freeze(JSON.parse(b))}catch(c){W(c)}G.chara.forEach(({id:c})=>H.set(c,G.card.filter(d=>d.charaNo===c)))}),y=(a,b)=>{a.innerText=b;return a},m=(a,
...b)=>{a.classList.add(...b);return a},w=(a,...b)=>{a.classList.remove(...(b.length?b:a.classList));return a},X=(a,b)=>b.some(c=>a.classList.contains(c)),q=document.getElementById.bind(document),B=(a,b={})=>{Object.assign(a.dataset,b);return a},I=(a,b={})=>Object.assign(a,b),P=(a,b)=>{Object.assign(a.style,b);return a},fa=({dataset:a})=>["nativeimgkey","nativebgkey","src"].forEach(b=>delete a[b]),x=(a,b,c=document)=>c.querySelectorAll(a).forEach(b),g=(a,b=document)=>b.querySelector(a),e=(a="div",
{d:b={},c=[],g:d={},a:f=[],m:h={}}={},l=[])=>{(a=I(document.createElement(a),d)).append(...f,...l);return m(B(P(a,h),b),...c)},C=(a,b,c,d=!1,...f)=>{b.forEach(h=>a.addEventListener(h,d?(l,...t)=>{for(let p=l.target;p&&p!=l.currentTarget;p=p.parentNode)if(p.matches(d))return c(l,...t)}:c,...f));return a},Y=a=>fetch(new URL("magica/json/"+a+".json",location.origin),{cache:"force-cache"}).then(b=>location.hostname.toLowerCase().startsWith(ba)&&b.json()),sa=(a,b=!1)=>{a||(n.no_file=!0,a='{"data":{}}');
try{S=Object.freeze(JSON.parse(a))}catch(c){return W(c)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(n,("object"===typeof b?b:{})||{},S.adjustments||{});return S},Q=a=>z.classList.toggle("connecting",a),Z=(a,b=[],c=2,d=100)=>{a.font&&V.j(a.font).then(f=>b.push("@font-face{font-family:'Open Sans';src:url("+URL.createObjectURL(new Blob([f],{type:"font/ttf"}))+");}"));a.raw&&b.push(...a.raw);a.href&&document.head.append(e("link",{g:{rel:"stylesheet",type:"text/css",href:a.href}}));(new Promise(f=>{const h=
setInterval(()=>{var l=document.styleSheets[c];return l&&(clearInterval(h),f(l))},d)})).then(f=>b.forEach(h=>f.insertRule(h,f.cssRules.length)))},ha=()=>{var a=["lm_click","lm_touch"];return m(w(z,...a),a[+/ios|android/i.test(navigator.userAgent)])},ta=a=>(a=a.state)&&a.chara&&a.card?ia(a):(w(q("mainContent"),"hide"),m(q("cardDetail"),"hide"),ja("status")),D=(...a)=>{console.warn(...a);m(z,"lm_warn");C(I(q("loading"),{title:"An error occured. You can try to reload the page."}),["pointerup"],()=>location.reload());
return!1},W=(...a)=>{console.error(...a);m(z,"lm_error");C(I(g("p",I(q("loading"),{title:"An error occured. You can report about it."}))),["pointerup"],()=>location.assign(new URL(ca+"/"+ba+"/issues","https://github.com")));return!1},ka=a=>{a.forEach((b,c)=>N.set(c,b));N.forEach((b,c)=>{const d=O.get(b);d||D("unknown key",c);x("img[data-nativeimgkey="+c+"]",f=>fa(I(f,{src:d})));x(".lm_ob[data-nativebgkey="+c+"]",f=>fa(w(P(f,{backgroundImage:"url("+d+")"}),"lm_ob")))});return!1},R=async()=>{const a=
new Map;x("img[data-nativeimgkey]",({dataset:{nativeimgkey:b,src:c}})=>b&&!N.has(b)&&a.set(b,c));x(".lm_ob[data-nativebgkey]",({dataset:{nativebgkey:b,src:c}})=>b&&!N.has(b)&&a.set(b,c));if([...a.values()].every(O.has.bind(O)))return ka(a);Q(!0);return Promise.all([...(new Set([...a.keys()].filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>Y("card_c_"+b.substr(5,4)))).then(b=>Promise.all(b.map(ea))).then(()=>ka(a)).then(Q).catch(D)},la=(a,b)=>n.card_probability?Math.random()<n.card_probability:U.get(a)?.has(b),
ua=({attributeId:a,name:b,id:c,title:d,kana:f})=>e("div",{c:["lm_missing","chara","commonFrame4","se_decide",a],g:{title:b},d:{charaId:c,maxCardRank:0}},[e("div",{c:["nameWrap"]},[e("span",{c:["att",a]}),e("p",{c:["name"],g:{textContent:b}},[e("span",{c:["title"],g:{textContent:d}})]),e("p",{c:["kana"],g:{textContent:f}})]),e("div",{c:["charaIconWrap"]})]),J=(a,b,c="id")=>G[a].find(({[c]:d})=>d===b),A=(a,b)=>({nativeimgkey:a,src:"resource/image_native/"+b+"/"+a+".png"}),aa=(a,b)=>({["nat"+ca.substr(1,
2)+"ebgkey"]:a,src:"resource/image_native/"+b+"/"+a+".png"}),wa=async a=>{const b=a.id,c=n.chara_probability?Math.random()<n.chara_probability:U.get(b)?.size;return n.hide_missing&&!c?!1:(d=>{H.get(b).forEach(f=>{const {id:h,rank:l}=f,t=e("div",{c:["userCharaIcon",f.attributeId,l]});if(la(f.charaNo,h)){const p=+l.split("RANK_")[1];p>+Object.assign(d,{tabIndex:"2"}).dataset.maxCardRank&&B(w(d,"lm_missing"),{maxCardId:h,maxCardRank:p});t.append(...ma(f))}else t.append(e("span",{c:["closed"]}));g(".charaIconWrap",
d).append(t)});q("charaWrapInner").append(c?C(d,["pointerup"],va):d)})(ua(a))},ma=a=>[["att","att","attributeId"],["star","star","rank"],["rank","frame","rank"],[!1,"card","id","_f"],["bg","bg","attributeId"]].map(([b,c,d,f=""])=>(d=c+"_"+String(a[d]).toLowerCase()+f,b?e("span",{c:["lm_ob",b],d:aa(d,"card/frame")}):e("img",{g:{alt:""},d:A(d,"card/image")}))),va=a=>{if(!a.cancelable&&a.isTrusted&&n.fix_scrollbug)return!0;const {charaId:b,maxCardId:c}=a.currentTarget.dataset;a={page:"mgirl",chara:+b,
card:+c};history.pushState(a,"Magical Girl \u2116"+b);return ia(a)},ia=({chara:a,card:b})=>{xa(J("chara",a),J("card",b)).then(c=>!1!==c&&R()).then(()=>{m(q("mainContent"),"hide");w(q("cardDetail"),"hide")}).catch(D)},na=a=>e("div",{c:["detailWrap"]},[e("p",{c:["name","c_purple"],g:{innerText:a.name}}),e("div",{c:["common_line","lc_beige"]}),e("p",{c:["detail"],g:{innerText:a.shortDescription}})]),Aa=(a,b,c)=>{const {id:d,attributeId:f,title:h}=a,{id:l,rank:t,maxPieceSkillId:[p],doppelMagiaId:v,commandType:oa}=
b;(u=>{m(g("#att",u),f.toLowerCase());y(g(".charaName",u),a.name).append(...(h?[e("span",{c:["title","ts_pink"],g:{innerText:h}})]:[]))})(g("#detailCardName",c));(u=>g("#detailCardImage",c).append(e("div",{c:["lm_ob","cardFrame",t,f],d:aa("frame_"+f.toLowerCase()+"_"+t.toLowerCase(),"card/frame")}),e("img",{c:["cardImg","se_tabs"],g:{alt:"",title:"Tap to zoom in"},d:u}),e("img",{c:["zoomImg","se_tabs"],g:{alt:"",title:"Tap to zoom out"},d:u}),e("span",{c:["moviePlayBtn","se_tabs","TE"],g:{title:"Transformation videos are disabled in this version"}})))(A("card_"+
l+"_c","card/image"));(([u,F,K],pa)=>{(k=>{B(g("img",k),A("mini_"+b.miniCharaNo+"_s","mini/image"));m(g("#rare",k),t).append(...Array(pa).fill("span").map(r=>e(r)))})(g("#cardDetailMiniChara",u));(k=>{x(".currentLv,.maxLv",r=>y(r,[1,40,50,60,80,100][+t.split("RANK_")[1]]||1),g("#detailLv",k));y(g(".type>.tdStyle",k),{BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType])})(g(".statusWrap",u));
x("#popupCharaStatus .c_red",(k,r)=>y(k,+b[["hp","attack","defense"][r]]*(1+(n.keep_statbug?3:[0,2,2.2,2.4,2.6,3][+t.split("RANK_")[1]]||1)*{BALANCE:[1,1,1],ATTACK:[.98,1.03,.97],DEFENSE:[.97,.98,1.05],HP:[1.04,.97,.98],ATKDEF:[.99,1.02,1.01],ATKHP:[1.02,1.01,.99],DEFHP:[1.01,.99,1.02]}[b.growthType][r])|0),u);[[".profileWrap>.detail",a.description],[".exProfile1>.tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+pa+" Illustrator"],[".selIllustrator",b.illustrator],
[".selCharacterVoice",a.voiceActor]].forEach(([k,r])=>y(g(k,u),r));[["skill",".connect"],["magia",".magiaDetail"]].map(([k,r])=>{r=g(r,F);const {groupId:E,name:L,shortDescription:M}=J(k,b[k+"Id"]);B(g("img",r),A("icon_skill_"+E,"art"));y(g(".name",r),L);y(g(".detail",r),M)});g(".commandList",F).append(...oa.map(k=>e("li",{c:[n.all_discs||k]})));if(p){const k=J("pieceskill",p);g(".command",F).after(e("div",{c:["commonFrame3","connect"]},[e("p",{c:["common_title_frame"],g:{innerText:"EX Skill"}}),e("div",
{c:[n.keep_exbug?"flexbox":"flexBox"]},[e("p",{c:["img"]},[e("img",{d:A("icon_skill_"+k.groupId,"art")})]),na(k)])]))}v&&g(".magia",F).append(e("div",{c:["doppel","doppelDetail"]},[e("div",{c:["flexBox"]},[e("p",{c:["img","doppel"]},[e("img",{d:A("mini_"+b.doppelCharaNo+"_dd","mini/image")}),e("span",{c:["bg"]})]),na(J("magia",v))])]));g(".discPreview",K).append(...oa.map(k=>e("div",{c:["discWrap",k]},[e("div",{c:["discText"]}),e("img",{d:A("card_"+l+"_d","card/image")})])));H.get(d).forEach((k,r)=>
{var E=k.id;const L="\u2605"+ +k.rank.split("RANK_")[1],M=["mb_pink","se_decide"];E===l&&M.push("selected");E=la(d,E);g(".miniCharaBtn",K).append(y(e("p",E?{c:M,g:{tabIndex:"4"},d:{commandtype:"card",cardarrindex:r}}:{c:["mb_pink","off"]}),L));g(".selIllustIcon",K).append(e("div",{c:["cardIllustWrap"]},[e("div",E?{c:["userCharaIcon",k.attributeId],a:ma(k)}:{c:["offIcon"]}),e("p",E?{c:M,g:{innerText:L,tabIndex:"5"},d:{cardarrindex:r}}:{c:["mb_pink","off"],g:{innerText:L}})]))})})(["Status","Skill",
"Illust"].map(u=>g("#chara"+u,c)),+t.split("RANK_")[1]);[[".collectionBack",()=>history.back()],["#detailCardImage>img",()=>q("detailCardImage").classList.toggle("zoom")],["#detailTab>li",ja],[".moviePlayBtn",()=>setTimeout(u=>w(u),1500,m(q("ready"),"preNativeFadeIn"))],[".cardIllustWrap>.mb_pink",ya],[".miniCharaBtn>.mb_pink",za]].forEach(([u,F])=>x(u,K=>C(K,["pointerup"],F),c));return c},xa=async(a,b)=>{var c;if(c=b)c=B(q("cardDetail"),{charaId:a.id}),a=[Aa(a,b,da.cloneNode(!0))],c.replaceChildren(...a);
return c},ja=a=>{const b=a.currentTarget?.dataset.type??a;m(w(q("cardDetailWrap")),b);x("#detailTab>li",c=>(c.dataset.type===b?m:w)(c,"current"))},ya=({currentTarget:a})=>{if(!X(a,["off","selected"])){w(g(".cardIllustWrap>.selected"),"selected");var {id:b,rank:c,attributeId:d,illustrator:f}=H.get(+q("cardDetail").dataset.charaId)[+m(a,"selected").dataset.cardarrindex];(h=>{x("img",l=>B(l,A("card_"+b+"_c","card/image")),h);B(m(g(".cardFrame",h),"lm_ob"),aa("frame_"+d.toLowerCase()+"_"+c.toLowerCase(),
"card/frame"))})(q("detailCardImage"));y(g(".illustrator"),f);y(g(".selIllustTitle"),"\u2605"+ +c.split("RANK_")[1]+" Illustrator:");R().catch(D)}},za=({currentTarget:a})=>{if(!X(a,["off","selected"])){w(g(".miniCharaBtn>.selected"),"selected");a=m(a,"selected").dataset;var b=H.get(+q("cardDetail").dataset.charaId)[+(a.cardarrindex||0)],c=A(...("chara"===a.commandtype?["mini_"+b.miniCharaNo+"_d","mini/image"]:["card_"+b.id+"_d","card/image"]));x(".discPreview>.discWrap>img",d=>B(d,c));R().catch(D)}},
Ba=({currentTarget:a})=>{w(g(".tabBtns>.current"),"current");m(w(q("charaWrap")),m(a,"current").dataset.att.toLowerCase(),"commonFrame2")},Ca=({target:a})=>w(a,"touch"),Da=a=>void setTimeout(b=>b.remove(),700,(b=>document.body.appendChild(e("div",{c:["commonEffect"],m:{top:b.y-128+"px",left:b.x-128+"px"}},Array.from({length:3},(c,d)=>e("div",{c:["effect0"+(d+1)]})))))(a)),Ea=()=>{n.mirror&&m(z,"lm_rorrim");n.limit_height&&m(z,"lm_limit_height");n.fix_titlebug&&Z({raw:["{margin-left:8px;}",'::before{content:"[";}',
'::after{content:"]";}'].map(a=>"#detailCardName>.charaName>.title"+a)});n.no_file&&document.body.append(e("a",{g:{id:"lm_use_setup",href:new URL("setup",location.origin)}}));n.text_case&&m(z,"lm_to"+n.text_case);n.show_kana&&m(z,"lm_kana");n.font?Y("font/"+n.font).then(Z).catch(D):Z({href:new URL("css?family=Open+Sans:600","https://fonts.googleapis.com")})};return C(document,["DOMContentLoaded"],()=>{Q(!0);[[["resize"],()=>T=T?clearTimeout(T):setTimeout(ha,500)],[["popstate"],ta],[["error"],W]].forEach(c=>
C(window,...c));ha();[[["pointerdown"],".TE",({target:c})=>X(c,["off","current","selected"])||m(c,"touch")],[["pointerup","pointermove"],".TE",Ca],[["pointerdown"],"body",Da],[["keydown"],"[tabIndex]",c=>void("Enter"===c.key&&c.target.dispatchEvent(new PointerEvent("pointerup")))],[["contextmenu"],!1,c=>(c.preventDefault(),z.requestFullscreen().catch(D)),!1]].forEach(([c,d,f,h=!0])=>C(document,c,f,d,{passive:h}));history.replaceState({page:"mgirls"},"Magical Girls Gallery");const a=sa(...["gallery",
"adjustments"].map(c=>document.cookie.match(new RegExp("(?:^|;)\\s*"+c+"\\s*=\\s*([^;]*)"))?.pop()||null));Ea();const b=P(q("charaWrapInner"),{display:"none"});Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(Y)).then(c=>Promise.all([ra(c.pop().data),...c.map(ea)])).then(()=>{Object.entries(a.data).forEach(([c,d])=>U.set(+c,new Set(d.map(Number))));(c=>{da=c.content;c.remove()})(q("tmplCharaDetail"));return Promise.all(G.chara.map(wa))}).then(R).then(()=>{P(b,{display:"block"});x("#tabArea>.tabBtns>li",c=>C(c,["pointerup"],Ba));Q(!1)}).catch(D)},!1,{once:!0})})
("todestrieb", "LiviaMedeiros");
