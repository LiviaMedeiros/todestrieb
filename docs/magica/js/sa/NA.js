/*! todestrieb: Magical Girls Gallery Â© 2021 LiviaMedeiros */
'use strict';((N,E)=>{var y={},r={},F={},O=null,G=null,H={},t={},I={},g={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1};const J=a=>fetch("/magica/json/"+a+".json",{cache:"force-cache"}).then(b=>location.hostname.toLowerCase().startsWith(N)&&b.json()),P=a=>Object.assign(H,a),ba=(a,b=!1)=>{a||(g.no_file=!0,a='{"data":{}}');try{I=JSON.parse(a)}catch(c){return K(c)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(g,
("object"===typeof b?b:{})||{},I.adjustments||{});return JSON.stringify(I)},z=a=>$("body")[a?"addClass":"removeClass"](["connecting"]),L=(a,b=[],c=2,e=100)=>{a.font&&b.push("@font-face{font-family:'Open Sans';src:url('data:font/ttf;base64,"+String(a.font)+"');}");a.raw&&b.push(...a.raw);a.href&&$("<link/>",{rel:"stylesheet",type:"text/css",href:a.href}).appendTo("head");(new Promise(f=>{const k=setInterval(()=>{var m=document.styleSheets[c];return m&&(clearInterval(k),f(m))},e)})).then(f=>b.forEach(k=>
f.insertRule(k,f.cssRules.length)))},Q=()=>$("body").removeClass(["lm_touch","lm_click"]).addClass([navigator.userAgent.match(/ios|android/i)?"lm_touch":"lm_click"]),ca=a=>(a=a.originalEvent.state)&&a.h&&a.g?R(a.h,a.g):($("#mainContent").removeClass(["hide"]),$("#cardDetail").addClass(["hide"]),S("status")),u=a=>{$("body").addClass(["lm_warn"]);$("#loading").attr({title:"An error occured. You can try to reload the page."}).on("pointerup",()=>location.reload());return console.warn(a),!1},K=a=>{$("body").addClass(["lm_error"]);
$("#loading").attr({title:"An error occured. You can report about it."}).find("p").on("pointerup",()=>location.assign("https://github.com/"+E+"/"+N+"/issues"));return console.error(a.originalEvent),!1},T=a=>Object.entries(Object.assign(F,a)).forEach(([b,c])=>(c=H[c])?($("[data-nativeimgkey="+b+"]").removeAttr("data-nativeimgkey").attr({src:"data:image/png;base64,"+c}),$("[data-nativebgkey="+b+"]").removeAttr("data-nativebgkey").css({backgroundImage:"url(data:image/png;base64,"+c+")"})):u(b)),A=()=>
{let a={};$("[data-nativeimgkey]").each((b,{dataset:c})=>(b=c.nativeimgkey)&&!F[b]?a[b]=c.src:!0);$("[data-nativebgkey]").each((b,{dataset:c})=>(b=c.nativebgkey)&&!F[b]?a[b]=c.src:!0);if(!Object.values(a).filter(b=>!(b in H)).length)return T(a);z(!0);Promise.all([...(new Set(Object.keys(a).filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>J("card_c_"+b.substr(5,4)))).then(b=>{b.forEach(P);T(a);z(!1)}).catch(u)},U=(a,b)=>g.card_probability?Math.random()<g.card_probability:r[a]&&r[a].includes(b),da=a=>
g.chara_probability?Math.random()<g.chara_probability:r[a]&&0<r[a].length,ea=({attributeId:a,name:b,id:c,title:e,kana:f})=>$("<div>",{"class":"lm_missing chara commonFrame4 se_decide "+a,title:b,data:{charaId:c,maxCardRank:0},append:[$("<div>",{"class":"nameWrap",append:[$("<span>",{"class":"att "+a}),$("<p>",{"class":"name",text:b,append:$("<span>",{"class":"title",text:e})}),$("<p>",{"class":"kana",text:f})]}),$("<div>",{"class":"charaIconWrap"})]}),B=(a,b)=>t[a].data.find(({id:c})=>c==b),n=(a,
b)=>({"data-nativeimgkey":a,"data-src":b}),ha=a=>{const b=da(a.id);if(g.hide_missing&&!b)return!1;const c=ea(a);(y[a.id]=t.card.data.filter(e=>e.charaNo==a.id)).forEach(e=>{var f=e.rank;const k=$("<div>",{"class":"userCharaIcon "+e.attributeId+" "+f});U(e.charaNo,e.cardId)?(f=+f.split("RANK_")[1],f>c.data("maxCardRank")&&c.data({maxCardId:e.cardId,maxCardRank:f}).removeClass(["lm_missing"]),c.attr({tabindex:"2"}),k.append(V(e))):k.append($("<span>",{"class":"closed"}));$(".charaIconWrap",c).append(k)});
$("#charaWrapInner").append(b?c.on("pointerup",fa):c)},V=a=>[["att","att","attributeId"],["star","star","rank"],["rank","frame","rank"],[!1,"card","cardId","_f"],["bg","bg","attributeId"]].map(([b,c,e,f=""])=>(e=c+"_"+a[e].toString().toLowerCase()+f,b?$("<span>",{"class":b,"data-nativebgkey":e,"data-src":"resource/image_native/card/frame/"+e+".png"}):$("<img>",n(e,"resource/image_native/card/image/"+e+".png")))),fa=a=>{if(!a.cancelable&&!a.isTrigger&&g.fix_scrollbug)return!0;a.preventDefault();const {charaId:b,
maxCardId:c}=$(a.currentTarget).data();history.pushState({page:"mgirl",h:b,g:c},"Magical Girl \u2116"+b);return R(b,c)},R=(a,b)=>{if(!ia(B("chara",a),t.card.data.find(c=>c.cardId==b)))return!1;A();$("#mainContent").addClass(["hide"]);$("#cardDetail").removeClass(["hide"])},W=a=>$("<div>",{"class":"detailWrap",append:[$("<p>",{"class":"name c_purple",text:a.name}),$("<div>",{"class":"common_line lc_beige"}),$("<p>",{"class":"detail",text:a.shortDescription})]}),ia=(a,b)=>{if(!b)return!1;const c=O.clone(),
[e,f,k,m,q,X,Y,Z]=[a.id,a.attributeId,a.title,b.cardId,b.rank,b.miniCharaNo,b.maxPieceSkillId1,b.doppelMagiaId];(d=>{$("#att",d).addClass([f.toLowerCase()]);$(".charaName",d).text(a.name).append(k&&$("<span>",{"class":"title ts_pink",text:k}))})($("#detailCardName",c));var p="frame_"+f.toLowerCase()+"_"+q.toLowerCase(),v={alt:"",["data-nat"+E.substr(1,2)+"eimgkey"]:"card_"+m+"_c","data-src":"resource/image_native/card/image/card_"+m+"_c.png"};$("#detailCardImage",c).append($("<div>",{"data-nativebgkey":p,
"data-src":"resource/image_native/card/frame/"+p+".png","class":"cardFrame "+q+" "+f}),$("<img>",{"class":"cardImg se_tabs",title:"Tap to zoom in"}).attr(v),$("<img>",{"class":"zoomImg se_tabs",title:"Tap to zoom out"}).attr(v),$("<span>",{"class":"moviePlayBtn se_tabs TE",title:"Transformation videos are disabled in this version"}));const aa=+q.split("RANK_")[1],[C,D,M]=["Status","Skill","Illust"].map(d=>$("#chara"+d,c));(d=>{$("img",d).attr(n("mini_"+X+"_s","resource/image_native/mini/image/mini_"+
X+"_s.png"));d=$("#rare",d).removeClass().addClass([q]);for(let h=aa;0<h--;d.append($("<span>")));})($("#cardDetailMiniChara",C));(d=>{$(".currentLv,.maxLv",$("#detailLv",d)).text([1,40,50,60,80,100][+q.split("RANK_")[1]]||1);$(".type>.tdStyle",d).text({BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType])})($(".statusWrap",C));(d=>({BALANCE:[1,1,1],ATTACK:[.98,1.03,.97],DEFENSE:[.97,.98,1.05],
HP:[1.04,.97,.98],ATKDEF:[.99,1.02,1.01],ATKHP:[1.02,1.01,.99],DEFHP:[1.01,.99,1.02]})[b.growthType].map((h,l)=>d.eq(l).text(+b[["hp","attack","defense"][l]]*(1+(g.keep_statbug?3:[0,2,2.2,2.4,2.6,3][+q.split("RANK_")[1]]||1)*h)|0)))($("#popupCharaStatus .c_red",C));[[".profileWrap>.detail",a.description],[".exProfile1>.tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+aa+" Illustrator"],[".selIllustrator",b.illustrator],[".selCharacterVoice",a.voiceActor]].forEach(([d,
h])=>$(d,C).text(h));[["skill",".connect"],["magia",".magiaDetail"]].map(([d,h])=>{h=$(h,D);const {groupId:l,name:w,shortDescription:x}=B(d,b[d+"Id"]);$("img",h).attr(n("icon_skill_"+l,"resource/image_native/art/icon_skill_"+l+".png"));$(".name",h).text(w);$(".detail",h).text(x)});(d=>{for(let h=0;5>h++;d.append($("<li>",{"class":g.all_discs||b["commandType"+h]})));})($(".commandList",D));Y&&(p=B("pieceskill",Y),v=p.groupId,$(".command",D).after($("<div>",{"class":"commonFrame3 connect",append:[$("<p>",
{"class":"common_title_frame",text:"EX Skill"}),$("<div>",{"class":g.keep_exbug?"flexbox":"flexBox",append:[$("<p>",{"class":"img",append:$("<img>",n("icon_skill_"+v,"resource/image_native/art/icon_skill_"+v+".png"))}),W(p)]})]})));Z&&(p=b.doppelCharaNo,$(".magia",D).append($("<div>",{"class":"doppel doppelDetail",append:$("<div>",{"class":"flexBox",append:[$("<p>",{"class":"img doppel",append:[$("<img>",n("mini_"+p+"_dd","resource/image_native/mini/image/mini_"+p+"_dd.png")),$("<span>",{"class":"bg"})]}),
W(B("magia",Z))]})})));((d,h)=>{for(let l=0;5>l++;d.append($("<div>",{"class":"discWrap "+b["commandType"+l],append:[$("<div>",{"class":"discText"}),h]}).clone()));})($(".discPreview",M),$("<img>",n("card_"+m+"_d","resource/image_native/card/image/card_"+m+"_d.png")));y[e].forEach((d,h)=>{const l=d.cardId,w="\u2605"+ +d.rank.split("RANK_")[1],x=U(e,l);$(".miniCharaBtn",M).append($("<p>",x?{"class":"mb_pink se_decide"+(l==m?" selected":""),tabindex:"4",data:{commandtype:"card",cardarrindex:h}}:{"class":"mb_pink off"}).text(w));
$(".selIllustIcon",M).append($("<div>",{"class":"cardIllustWrap"}).append($("<div>",x?{"class":"userCharaIcon "+d.attributeId,append:V(d)}:{"class":"offIcon"}),$("<p>",x?{"class":"mb_pink se_decide"+(l==m?" selected":""),text:w,tabindex:"5",data:{cardarrindex:h}}:{"class":"mb_pink off",text:w})))});$("#cardDetail").data({charaId:e}).off().on("pointerup",".collectionBack",()=>history.back()).on("pointerup","#detailCardImage>.cardImg,#detailCardImage>.zoomImg",()=>$("#detailCardImage").toggleClass("zoom")).on("pointerup",
"#detailTab>li",S).on("pointerup",".moviePlayBtn",()=>setTimeout(d=>d.removeClass(),1500,$("#ready").addClass(["preNativeFadeIn"]))).on("pointerup",".cardIllustWrap>.mb_pink",ja).on("pointerup",".miniCharaBtn>.mb_pink",ka).empty().append(c);return!0},S=a=>{a=a.currentTarget?$(a.currentTarget).attr("name"):a;$("#cardDetailWrap").removeClass().addClass([a]);$("#detailTab>li").removeClass(["current"]).filter("[name="+a+"]").addClass(["current"])},ja=a=>{a.preventDefault();$(".cardIllustWrap>.selected").removeClass(["selected"]);
const {cardId:b,rank:c,attributeId:e,illustrator:f}=y[$("#cardDetail").data("charaId")][$(a.currentTarget).addClass(["selected"]).data("cardarrindex")];a="frame_"+e.toLowerCase()+"_"+c.toLowerCase();var k=$("#detailCardImage");$(".cardImg,.zoomImg",k).attr(n("card_"+b+"_c","resource/image_native/card/image/card_"+b+"_c.png"));$(".cardFrame",k).attr({["data-nat"+E.substr(1,2)+"ebgkey"]:a,"data-src":"resource/image_native/card/frame/"+a+".png"});$(".illustrator").text(f);$(".selIllustTitle").text("\u2605"+
+c.split("RANK_")[1]+" Illustrator:");A()},ka=a=>{a.preventDefault();a=$(a.currentTarget);if(!a.is(".off,.selected")){$(".miniCharaBtn>.selected").removeClass("selected");var {cardarrindex:b,commandtype:c}=a.addClass(["selected"]).data(),{miniCharaNo:e,cardId:f}=y[$("#cardDetail").data("charaId")][b||0];"chara"==c?(b="mini/image/",c="mini_"+e+"_d"):(b="card/image/",c="card_"+f+"_d");$(".discPreview>.discWrap>img").attr(n(c,"resource/image_native/"+b+c+".png"));A()}},la=a=>{a.preventDefault();$(".tabBtns>.current").removeClass(["current"]);
$("#charaWrap").removeClass().addClass([$(a.currentTarget).addClass(["current"]).data("att").toLowerCase(),"commonFrame2"])};$(document).on("pointerdown",".TE",a=>$(a.currentTarget).not(".off,.current,.selected").addClass(["touch"])).on("pointermove pointerup",".TE",a=>$(a.currentTarget).removeClass(["touch"])).on("pointerdown","body",a=>setTimeout(b=>b.remove(),700,$("<div>",{"class":"commonEffect",css:{top:a.clientY-128+"px",left:a.clientX-128+"px"},append:[$("<div>",{"class":"effect01"}),$("<div>",
{"class":"effect02"}),$("<div>",{"class":"effect03"})]}).appendTo("body"))).on("keydown","[tabindex]",a=>("Enter"==a.key&&$(a.currentTarget).trigger("pointerup"),!0)).on("contextmenu",a=>(a.preventDefault(),document.documentElement.requestFullscreen().catch(u))).one("DOMContentLoaded",()=>{z(!0);Q();$(window).on({resize:()=>G=G?clearTimeout(G):setTimeout(Q,500),popstate:ca,"error unhandledrejection":K});history.replaceState({page:"mgirls"},"Magical Girls Gallery");const a=ba((document.cookie.match(/(?:^|; )gallery=([^;]*)/)||
[0,null])[1],(document.cookie.match(/(?:^|; )adjustments=([^;]*)/)||[0,null])[1]);g.mirror&&$("body").addClass(["lm_rorrim"]);g.limit_height&&$("body").addClass(["lm_limit_height"]);g.fix_titlebug&&L({raw:["{margin-left:8px;}",'::before{content:"[";}','::after{content:"]";}'].map(b=>"#detailCardName>.charaName>.title"+b)});g.no_file&&$("<a/>",{id:"lm_use_setup",href:"/setup"}).appendTo("body");g.text_case&&$("body").addClass(["lm_to"+g.text_case]);g.font?J("font/"+g.font).then(L).catch(u):L({href:"https://fonts.googleapis.com/css?family=Open+Sans:600"});
Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(J)).then(b=>{var c=b.pop().data;try{t=JSON.parse([...c].reverse().join(""))}catch(e){K(e)}b.forEach(P);r=JSON.parse(a).data||{};b=$("#charaWrapInner").css({display:"none"});O=$("#tmplCharaDetail").detach().removeAttr("id style");t.chara.data.forEach(ha);A();z(!1);b.css({display:"block"});$("#tabArea>.tabBtns>li").on("pointerup",la)}).catch(u)})})
("todestrieb", "LiviaMedeiros");
