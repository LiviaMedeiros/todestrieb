/*! todestrieb: Magical Girls Gallery Â© 2021 LiviaMedeiros */
'use strict';((Y,Z)=>{var B=null,O={},m={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,show_kana:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1},aa=null,P=null;const C=new Map,Q=new Map,I=new Map,J=new Map,ba=["lm_click","lm_touch"],R=(a,b=189)=>{a=a.replace(/[^A-Za-z0-9\+\/]/g,"");for(var c=a.length,e=Math.ceil(3*c+1>>2),h=new Uint8Array(e),k,n=0,q=0,v=0;v<c;v++){k=v&3;let t=a.charCodeAt(v);n|=(64<t&&91>t?t-65:96<t&&123>t?t-71:47<
t&&58>t?t+4:43===t?62:47===t?63:0)<<6*(3-k);if(3===k||1===c-v){for(k=0;3>k&&q<e;k++,q++)h[q]=n>>>(16>>>k&24)&255^b;n=0}}return h},w=(a,b)=>{a.innerText=b;return a},l=(a,...b)=>{a.classList.add(...b);return a},u=(a,...b)=>{a.classList.remove(...(b.length?b:a.classList));return a},S=(a,b)=>b.some(c=>a.classList.contains(c)),r=document.getElementById.bind(document),y=(a,b={})=>{Object.assign(a.dataset,b);return a},A=(a,b,c=document)=>c.querySelectorAll(a).forEach(b),f=(a,b=document)=>b.querySelector(a),
d=(a="div",b={},c=[])=>{const {d:e={},c:h=[],g:k={},a:n=[],h:q={}}=b;(a=Object.assign(document.createElement(a),k)).append(...n,...c);Object.assign(a.style,q);return l(y(a,e),...h)},T=a=>fetch(new URL("magica/json/"+a+".json",location.origin),{cache:"force-cache"}).then(b=>location.hostname.toLowerCase().startsWith(Y)&&b.json()),ca=a=>Object.entries(a).forEach(([b,c])=>J.set(b,new URL(URL.createObjectURL(new Blob([R(c,0)],{type:"image/png"}))))),na=(a,b=!1)=>{a||(m.no_file=!0,a='{"data":{}}');try{O=
Object.freeze(JSON.parse(a))}catch(c){return U(c)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(m,("object"===typeof b?b:{})||{},O.adjustments||{});return O},K=a=>document.documentElement.classList.toggle("connecting",a),oa=a=>{a=(new TextDecoder).decode(R(a));try{B=Object.freeze(JSON.parse(a))}catch(b){U(b)}B.chara.forEach(({id:b})=>C.set(b,B.card.filter(c=>c.charaNo===b)))},V=(a,b=[],c=2,e=100)=>{a.font&&b.push("@font-face{font-family:'Open Sans';src:url("+URL.createObjectURL(new Blob([R(a.font)],
{type:"font/ttf"}))+");}");a.raw&&b.push(...a.raw);a.href&&document.head.append(d("link",{g:{rel:"stylesheet",type:"text/css",href:a.href}}));(new Promise(h=>{const k=setInterval(()=>{var n=document.styleSheets[c];return n&&(clearInterval(k),h(n))},e)})).then(h=>b.forEach(k=>h.insertRule(k,h.cssRules.length)))},da=()=>l(u(document.documentElement,...ba),ba[+/ios|android/i.test(navigator.userAgent)]),pa=a=>(a=a.originalEvent?.state)&&a.chara&&a.card?ea(a):(u(r("mainContent"),"hide"),l(r("cardDetail"),
"hide"),fa("status")),D=a=>{l(document.documentElement,"lm_warn");Object.assign(r("loading")??{},{title:"An error occured. You can try to reload the page.",onpointerup:()=>location.reload()});return console.warn(a),!1},U=a=>{l(document.documentElement,"lm_error");$("#loading").attr({title:"An error occured. You can report about it."}).find("p").on("pointerup",()=>location.assign(new URL(Z+"/"+Y+"/issues","https://github.com")));return console.error(a.originalEvent),!1},ha=a=>{a.forEach((b,c)=>I.set(c,
b));I.forEach((b,c)=>(b=J.get(b))?($("img[data-nativeimgkey="+c+"]").removeAttr("data-nativeimgkey data-src").attr({src:b}),$(".lm_ob[data-nativebgkey="+c+"]").removeClass(["lm_ob"]).removeAttr("data-nativebgkey data-src").css({backgroundImage:"url("+b+")"})):D(c))},L=(a=new Map)=>{A("img[data-nativeimgkey]",({dataset:{nativeimgkey:b,src:c}})=>b&&!I.has(b)&&a.set(b,c));A(".lm_ob[data-nativebgkey]",({dataset:{nativebgkey:b,src:c}})=>b&&!I.has(b)&&a.set(b,c));if([...a.values()].every(J.has.bind(J)))return ha(a);
K(!0);Promise.all([...(new Set([...a.keys()].filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>T("card_c_"+b.substr(5,4)))).then(b=>{b.forEach(ca);ha(a);K(!1)}).catch(D)},ia=(a,b)=>m.card_probability?Math.random()<m.card_probability:Q.get(a)?.has(b),qa=({attributeId:a,name:b,id:c,title:e,kana:h})=>d("div",{c:["lm_missing","chara","commonFrame4","se_decide",a],g:{title:b},d:{charaId:c,maxCardRank:0}},[d("div",{c:["nameWrap"]},[d("span",{c:["att",a]}),d("p",{c:["name"],g:{textContent:b}},[d("span",{c:["title"],
g:{textContent:e}})]),d("p",{c:["kana"],g:{textContent:h}})]),d("div",{c:["charaIconWrap"]})]),E=(a,b,c="id")=>B[a].find(({[c]:e})=>e===b),x=(a,b)=>({nativeimgkey:a,src:"resource/image_native/"+b+"/"+a+".png"}),W=(a,b)=>({["nat"+Z.substr(1,2)+"ebgkey"]:a,src:"resource/image_native/"+b+"/"+a+".png"}),sa=a=>{const b=a.id,c=m.chara_probability?Math.random()<m.chara_probability:Q.get(b)?.size;if(m.hide_missing&&!c)return!1;const e=qa(a);C.get(b).forEach(h=>{const {id:k,rank:n}=h,q=d("div",{c:["userCharaIcon",
h.attributeId,n]});if(ia(h.charaNo,k)){const v=+n.split("RANK_")[1];v>+Object.assign(e,{tabIndex:"2"}).dataset.maxCardRank&&y(u(e,"lm_missing"),{maxCardId:k,maxCardRank:v});q.append(...ja(h))}else q.append(d("span",{c:["closed"]}));f(".charaIconWrap",e).append(q)});c&&e.addEventListener("pointerup",ra);r("charaWrapInner").append(e)},ja=a=>[["att","att","attributeId"],["star","star","rank"],["rank","frame","rank"],[!1,"card","id","_f"],["bg","bg","attributeId"]].map(([b,c,e,h=""])=>(e=c+"_"+String(a[e]).toLowerCase()+
h,b?d("span",{c:["lm_ob",b],d:W(e,"card/frame")}):d("img",{g:{alt:""},d:x(e,"card/image")}))),ra=a=>{if(!a.cancelable&&a.isTrusted&&m.fix_scrollbug)return!0;a.preventDefault();const {charaId:b,maxCardId:c}=a.currentTarget.dataset;a={page:"mgirl",chara:+b,card:+c};history.pushState(a,"Magical Girl \u2116"+b);return ea(a)},ea=({chara:a,card:b})=>{if(!ta(E("chara",a),E("card",b)))return!1;L();l(r("mainContent"),"hide");u(r("cardDetail"),"hide")},ka=a=>d("div",{c:["detailWrap"]},[d("p",{c:["name","c_purple"],
g:{innerText:a.name}}),d("div",{c:["common_line","lc_beige"]}),d("p",{c:["detail"],g:{innerText:a.shortDescription}})]),ta=(a,b)=>{if(!b)return!1;const c=aa.cloneNode(!0),{id:e,attributeId:h,title:k}=a,{id:n,rank:q,maxPieceSkillId:[v],doppelMagiaId:t,commandType:la}=b;(g=>{l(f("#att",g),h.toLowerCase());w(f(".charaName",g),a.name).append(...(k?[d("span",{c:["title","ts_pink"],g:{innerText:k}})]:[]))})(f("#detailCardName",c));var F=x("card_"+n+"_c","card/image");f("#detailCardImage",c).append(d("div",
{c:["lm_ob","cardFrame",q,h],d:W("frame_"+h.toLowerCase()+"_"+q.toLowerCase(),"card/frame")}),d("img",{c:["cardImg","se_tabs"],g:{title:"Tap to zoom in"},d:F}),d("img",{c:["zoomImg","se_tabs"],g:{title:"Tap to zoom out"},d:F}),d("span",{c:["moviePlayBtn","se_tabs","TE"],g:{title:"Transformation videos are disabled in this version"}}));const ma=+q.split("RANK_")[1],[M,N,X]=["Status","Skill","Illust"].map(g=>f("#chara"+g,c));(g=>{y(f("img",g),x("mini_"+b.miniCharaNo+"_s","mini/image"));l(f("#rare",
g),q).append(...Array(ma).fill("span").map(p=>d(p)))})(f("#cardDetailMiniChara",M));(g=>{A(".currentLv,.maxLv",p=>w(p,[1,40,50,60,80,100][+q.split("RANK_")[1]]||1),f("#detailLv",g));w(f(".type>.tdStyle",g),{BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType])})(f(".statusWrap",M));A("#popupCharaStatus .c_red",(g,p)=>w(g,+b[["hp","attack","defense"][p]]*(1+(m.keep_statbug?3:[0,2,2.2,2.4,2.6,
3][+q.split("RANK_")[1]]||1)*{BALANCE:[1,1,1],ATTACK:[.98,1.03,.97],DEFENSE:[.97,.98,1.05],HP:[1.04,.97,.98],ATKDEF:[.99,1.02,1.01],ATKHP:[1.02,1.01,.99],DEFHP:[1.01,.99,1.02]}[b.growthType][p])|0),M);[[".profileWrap>.detail",a.description],[".exProfile1>.tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+ma+" Illustrator"],[".selIllustrator",b.illustrator],[".selCharacterVoice",a.voiceActor]].forEach(([g,p])=>w(f(g,M),p));[["skill",".connect"],["magia",".magiaDetail"]].map(([g,
p])=>{p=f(p,N);const {groupId:z,name:G,shortDescription:H}=E(g,b[g+"Id"]);y(f("img",p),x("icon_skill_"+z,"art"));w(f(".name",p),G);w(f(".detail",p),H)});f(".commandList",N).append(...la.map(g=>d("li",{c:[m.all_discs||g]})));f(".discPreview",X).append(...la.map(g=>d("div",{c:["discWrap",g]},[d("div",{c:["discText"]}),d("img",{d:x("card_"+n+"_d","card/image")})])));v&&(F=E("pieceskill",v),f(".command",N).after(d("div",{c:["commonFrame3","connect"]},[d("p",{c:["common_title_frame"],g:{innerText:"EX Skill"}}),
d("div",{c:[m.keep_exbug?"flexbox":"flexBox"]}[d("p",{c:["img"]},[d("img",{d:x("icon_skill_"+F.groupId,"art")})]),ka(F)])])));t&&f(".magia",N).append(d("div",{c:["doppel","doppelDetail"]},[d("div",{c:["flexBox"]},[d("p",{c:["img","doppel"]},[d("img",{d:x("mini_"+b.doppelCharaNo+"_dd","mini/image")}),d("span",{c:["bg"]})]),ka(E("magia",t))])]));C.get(e).forEach((g,p)=>{var z=g.id;const G=["mb_pink","se_decide"];z===n&&G.push("selected");const H="\u2605"+ +g.rank.split("RANK_")[1];z=ia(e,z);f(".miniCharaBtn",
X).append(w(d("p",z?{c:G,g:{tabIndex:"4"},d:{commandtype:"card",cardarrindex:p}}:{c:["mb_pink","off"]}),H));f(".selIllustIcon",X).append(d("div",{c:["cardIllustWrap"]},[d("div",z?{c:["userCharaIcon",g.attributeId],a:ja(g)}:{c:["offIcon"]}),d("p",z?{c:G,g:{innerText:H,tabIndex:"5"},d:{cardarrindex:p}}:{c:["mb_pink","off"],g:{innerText:H}})]))});$(y(r("cardDetail"),{charaId:e})).off().on("pointerup",".collectionBack",()=>history.back()).on("pointerup","#detailCardImage>img",()=>r("detailCardImage").classList.toggle("zoom")).on("pointerup",
"#detailTab>li",fa).on("pointerup",".moviePlayBtn",()=>setTimeout(g=>u(g),1500,l(r("ready"),"preNativeFadeIn"))).on("pointerup",".cardIllustWrap>.mb_pink",ua).on("pointerup",".miniCharaBtn>.mb_pink",va).empty().append(c);return!0},fa=a=>{const b=a.currentTarget?.dataset?.type??a;l(u(r("cardDetailWrap")),b);A("#detailTab>li",c=>(c.dataset.type===b?l:u)(c,"current"))},ua=a=>{a.preventDefault();a=a.currentTarget;if(!S(a,["off","selected"])){u(f(".cardIllustWrap>.selected"),"selected");var {id:b,rank:c,
attributeId:e,illustrator:h}=C.get(+r("cardDetail").dataset.charaId)[+l(a,"selected").dataset.cardarrindex];(k=>{A("img",n=>y(n,x("card_"+b+"_c","card/image")),k);y(l(f(".cardFrame",k),"lm_ob"),W("frame_"+e.toLowerCase()+"_"+c.toLowerCase(),"card/frame"))})(r("detailCardImage"));w(f(".illustrator"),h);w(f(".selIllustTitle"),"\u2605"+ +c.split("RANK_")[1]+" Illustrator:");L()}},va=a=>{a.preventDefault();a=a.currentTarget;if(!S(a,["off","selected"])){u(f(".miniCharaBtn>.selected"),"selected");a=l(a,
"selected").dataset;var b=C.get(+r("cardDetail").dataset.charaId)[+(a.cardarrindex||0)],c=x(...("chara"===a.commandtype?["mini_"+b.miniCharaNo+"_d","mini/image"]:["card_"+b.id+"_d","card/image"]));A(".discPreview>.discWrap>img",e=>y(e,c));L()}},wa=a=>{a.preventDefault();u(f(".tabBtns>.current"),"current");l(u(r("charaWrap")),l(a.currentTarget,"current").dataset.att.toLowerCase(),"commonFrame2")};$(document).on("pointerdown",".TE",({currentTarget:a})=>S(a,["off","current","selected"])||l(a,"touch")).on("pointermove pointerup",
".TE",({currentTarget:a})=>u(a,"touch")).on("pointerdown","body",a=>setTimeout(b=>b.remove(),700,(b=>document.body.appendChild(d("div",{c:["commonEffect"],h:{top:b.clientY-128+"px",left:b.clientX-128+"px"}},Array.from({length:3},(c,e)=>d("div",{c:["effect0"+(e+1)]})))))(a))).on("keydown","[tabindex]",a=>("Enter"==a.key&&$(a.currentTarget).trigger("pointerup"),!0)).on("contextmenu",a=>(a.preventDefault(),document.documentElement.requestFullscreen().catch(D))).one("DOMContentLoaded",()=>{K(!0);da();
$(window).on({resize:()=>P=P?clearTimeout(P):setTimeout(da,500),popstate:pa,"error unhandledrejection":U});history.replaceState({page:"mgirls"},"Magical Girls Gallery");const a=na(...["gallery","adjustments"].map(b=>document.cookie.match(new RegExp("(?:^|;)\\s*"+b+"\\s*=\\s*([^;]*)"))?.pop()||null));m.mirror&&l(document.documentElement,"lm_rorrim");m.limit_height&&l(document.documentElement,"lm_limit_height");m.fix_titlebug&&V({raw:["{margin-left:8px;}",'::before{content:"[";}','::after{content:"]";}'].map(b=>
"#detailCardName>.charaName>.title"+b)});m.no_file&&document.body.append(d("a",{g:{id:"lm_use_setup",href:new URL("setup",location.origin)}}));m.text_case&&l(document.documentElement,"lm_to"+m.text_case);m.show_kana&&l(document.documentElement,"lm_kana");m.font?T("font/"+m.font).then(V).catch(D):V({href:new URL("css?family=Open+Sans:600","https://fonts.googleapis.com")});Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(T)).then(b=>{oa(b.pop().data);b.forEach(ca);
Object.entries(a.data).forEach(([c,e])=>Q.set(+c,new Set(e.map(Number))));b=r("charaWrapInner").style;b.display="none";(c=>{aa=c.content;c.remove()})(r("tmplCharaDetail"));B.chara.forEach(sa);L();K(!1);b.display="block";$("#tabArea>.tabBtns>li").on("pointerup",wa)}).catch(D)})})
("todestrieb", "LiviaMedeiros");
