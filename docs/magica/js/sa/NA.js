/*! todestrieb: Magical Girls Gallery Â© 2021 LiviaMedeiros */
'use strict';((I,u)=>{var v={},r={},y={},z=null,A={},n={},B={},f={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1};const C=a=>fetch("/magica/json/"+a+".json",{cache:"force-cache"}).then(b=>location.hostname.toLowerCase().startsWith(I)&&b.json()),J=a=>Object.assign(A,a),U=(a,b=!1)=>{a||(f.no_file=!0,a='{"data":{}}');try{B=JSON.parse(a)}catch(c){return D(c)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(f,
("object"===typeof b?b:{})||{},B.adjustments||{});return JSON.stringify(B)},w=a=>$("body")[a?"addClass":"removeClass"]("connecting"),E=(a,b=[],c=2,d=100)=>{a.font&&b.push("@font-face{font-family:'Open Sans';src:url('data:font/ttf;base64,"+String(a.font)+"');}");a.raw&&b.push(...a.raw);a.href&&$("<link/>",{rel:"stylesheet",type:"text/css",href:a.href}).appendTo("head");(new Promise(g=>{const l=setInterval(()=>{var k=document.styleSheets[c];return k&&(clearInterval(l),g(k))},d)})).then(g=>b.forEach(l=>
g.insertRule(l,g.cssRules.length)))},K=()=>$("body").removeClass("lm_touch lm_click").addClass(navigator.userAgent.match(/ios|android/i)?"lm_touch":"lm_click"),V=a=>(a=a.originalEvent.state)&&a.h&&a.g?L(a.h,a.g):($("#mainContent").removeClass("hide"),$("#cardDetail").addClass("hide"),M("status")),t=a=>{$("body").addClass("lm_warn");$("#loading").attr({title:"An error occured. You can try to reload the page."}).on("pointerup",()=>location.reload());return console.warn(a),!1},D=a=>{$("body").addClass("lm_error");
$("#loading").attr({title:"An error occured. You can report about it."}).find("p").on("pointerup",()=>location.assign("https://github.com/"+u+"/"+I+"/issues"));return console.error(a.originalEvent),!1},N=a=>Object.entries(Object.assign(y,a)).forEach(([b,c])=>(c=A[c])?($("[data-nativeimgkey="+b+"]").removeAttr("data-nativeimgkey").attr({src:"data:image/png;base64,"+c}),$("[data-nativebgkey="+b+"]").removeAttr("data-nativebgkey").css({backgroundImage:"url(data:image/png;base64,"+c+")"})):t(b)),x=()=>
{let a={};$("[data-nativeimgkey]").each((b,c)=>(b=c.dataset.nativeimgkey)&&!y[b]?a[b]=c.dataset.src:!0);$("[data-nativebgkey]").each((b,c)=>(b=c.dataset.nativebgkey)&&!y[b]?a[b]=c.dataset.src:!0);if(!Object.values(a).filter(b=>!(b in A)).length)return N(a);w(!0);Promise.all([...(new Set(Object.keys(a).filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>C("card_c_"+b.substr(5,4)))).then(b=>{b.forEach(J);N(a);w(!1)}).catch(t)},O=(a,b)=>f.card_probability?Math.random()<f.card_probability:r[a]&&r[a].includes(b),
W=a=>f.chara_probability?Math.random()<f.chara_probability:r[a]&&0<r[a].length,Y=a=>{const b=W(a.id);if(f.hide_missing&&!b)return!1;const c=a.attributeId,d=$("#tmplCharaListItem").clone().removeAttr("id style").addClass(c).attr({"chara-id":a.id,title:a.name});d.find(".nameWrap span.att").addClass(c);d.find(".nameWrap p.name").text(a.name).append($("<span>",{"class":"title",text:a.title}));d.find(".nameWrap p.kana").text(a.kana);(v[a.id]=n.card.data.filter(g=>g.charaNo==a.id)).forEach(g=>{var l=g.rank;
const k=$("<div>",{"class":"userCharaIcon "+g.attributeId+" "+l});O(g.charaNo,g.cardId)?(l=Number(l.split("RANK_")[1]),l>Number(d.attr("max-card-rank"))&&d.attr({"max-card-id":g.cardId,"max-card-rank":l}),d.attr({tabindex:"2"}),k.append(P(g))):k.append($("<span>",{"class":"closed"}));d.find(".charaIconWrap").append(k)});$("#charaWrapInner").append(b?d.on("pointerup",X):d)},P=a=>[["att","att","attributeId"],["star","star","rank"],["rank","frame","rank"],[!1,"card","cardId","_f"],["bg","bg","attributeId"]].map(([b,
c,d,g=""])=>(d=c+"_"+a[d].toString().toLowerCase()+g,b?$("<span>",{"class":b,"data-nativebgkey":d,"data-src":"resource/image_native/card/frame/"+d+".png"}):$("<img>",{"data-nativeimgkey":d,"data-src":"resource/image_native/card/image/"+d+".png"}))),X=a=>{if(!a.cancelable&&!a.isTrigger&&f.fix_scrollbug)return!0;a.preventDefault();var b=$(a.currentTarget);a=b.attr("chara-id");b=b.attr("max-card-id");history.pushState({page:"mgirl",h:a,g:b},"Magical Girl \u2116"+a);return L(a,b)},L=(a,b)=>{if(!Z(n.chara.data.find(c=>
c.id==a),n.card.data.find(c=>c.cardId==b)))return!1;x();$("#mainContent").addClass("hide");$("#cardDetail").removeClass("hide")},Q=a=>$("<div>",{"class":"detailWrap",append:[$("<p>",{"class":"name c_purple",text:a.name}),$("<div>",{"class":"common_line lc_beige"}),$("<p>",{"class":"detail",text:a.shortDescription})]}),Z=(a,b)=>{if(!b)return!1;const c=$("#tmplCharaDetail").clone().removeAttr("id style"),[d,g,l,k,q,R,S,T]=[a.id,a.attributeId,a.title,b.cardId,b.rank,b.miniCharaNo,b.maxPieceSkillId1,
b.doppelMagiaId];c.find("#detailCardName span#att").addClass(g.toLowerCase());c.find("#detailCardName p.charaName").text(a.name);l&&c.find("#detailCardName p.charaName").append($("<span>",{"class":"title ts_pink",text:l}));var h="frame_"+g.toLowerCase()+"_"+q.toLowerCase(),m={alt:"",["data-nat"+u.substr(1,2)+"eimgkey"]:"card_"+k+"_c","data-src":"resource/image_native/card/image/card_"+k+"_c.png"};c.find("#detailCardImage").append($("<div>",{"data-nativebgkey":h,"data-src":"resource/image_native/card/frame/"+
h+".png","class":"cardFrame "+q+" "+g}),$("<img>",{"class":"cardImg se_tabs",title:"Tap to zoom in"}).attr(m),$("<img>",{"class":"zoomImg se_tabs",title:"Tap to zoom out"}).attr(m),$("<span>",{"class":"moviePlayBtn se_tabs TE",title:"Transformation videos are disabled in this version"}));h=q.split("RANK_")[1];m=c.find("#cardDetailMiniChara");m.find("img").attr({"data-nativeimgkey":"mini_"+R+"_s","data-src":"resource/image_native/mini/image/mini_"+R+"_s.png"});m.find("#rare").attr({"class":q});for(let e=
Number(h);0<e--;m.find("#rare").append($("<span>")));m=c.find(".statusWrap");m.find("#detailLv .currentLv, #detailLv .maxLv").text({1:40,2:50,3:60,4:80,5:100}[q.split("RANK_")[1]]||1);m.find(".type span.tdStyle").text({BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType]);({BALANCE:[1,1,1],ATTACK:[.98,1.03,.97],DEFENSE:[.97,.98,1.05],HP:[1.04,.97,.98],ATKDEF:[.99,1.02,1.01],ATKHP:[1.02,1.01,
.99],DEFHP:[1.01,.99,1.02]})[b.growthType].map((e,p)=>c.find("#popupCharaStatus").find(".c_red").eq(p).text(Number(b[["hp","attack","defense"][p]])*(1+(f.keep_statbug?3:{1:2,2:2.2,3:2.4,4:2.6,5:3}[q.split("RANK_")[1]])*e)|0));[[".profileWrap .detail",a.description],[".exProfile1 .tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+h+" Illustrator"],[".selIllustrator",b.illustrator],[".selCharacterVoice",a.voiceActor]].forEach(([e,p])=>c.find(e).text(p));h=n.skill.data.find(e=>
e.id==b.skillId);a=n.magia.data.find(e=>e.id==b.magiaId);for(m=0;5>m++;c.find("#charaSkill ul.commandList").append($("<li>",{"class":f.all_discs||b["commandType"+m]})));c.find("#charaSkill div.connect img").attr({"data-nativeimgkey":"icon_skill_"+h.groupId,"data-src":"resource/image_native/art/icon_skill_"+h.groupId+".png"});c.find("#charaSkill div.connect p.name").text(h.name);c.find("#charaSkill div.connect p.detail").text(h.shortDescription);S&&(h=n.pieceskill.data.find(e=>e.id==S),c.find("#charaSkill div.command").after($("<div>",
{"class":"commonFrame3 connect",append:[$("<p>",{"class":"common_title_frame",text:"EX Skill"}),$("<div>",{"class":f.keep_exbug?"flexbox":"flexBox",append:[$("<p>",{"class":"img",append:$("<img>",{"data-nativeimgkey":"icon_skill_"+h.groupId,"data-src":"resource/image_native/art/icon_skill_"+h.groupId+".png"})}),Q(h)]})]})));c.find("#charaSkill div.magiaDetail img").attr({"data-nativeimgkey":"icon_skill_"+a.groupId,"data-src":"resource/image_native/art/icon_skill_"+a.groupId+".png"});c.find("#charaSkill div.magiaDetail p.name").text(a.name);
c.find("#charaSkill div.magiaDetail p.detail").text(a.shortDescription);T&&(a=b.doppelCharaNo,c.find("div.magia").append($("<div>",{"class":"doppel doppelDetail",append:$("<div>",{"class":"flexBox",append:[$("<p>",{"class":"img doppel",append:[$("<img>",{"data-nativeimgkey":"mini_"+a+"_dd","data-src":"resource/image_native/mini/image/mini_"+a+"_dd.png"}),$("<span>",{"class":"bg"})]}),Q(n.magia.data.find(e=>e.id==T))]})})));a=$("<img>",{"data-nativeimgkey":"card_"+k+"_d","data-src":"resource/image_native/card/image/card_"+
k+"_d.png"});for(h=0;5>h++;c.find("#charaIllust .discPreview").append($("<div>",{"class":"discWrap "+b["commandType"+h],append:[$("<div>",{"class":"discText"}),a]}).clone()));v[d].forEach((e,p)=>{const F=e.cardId,G="\u2605"+e.rank.split("RANK_")[1],H=O(d,F);c.find(".miniCharaBtn").append($("<p>",H?{"class":"mb_pink se_decide"+(F==k?" selected":""),tabindex:"4","data-commandtype":"card","data-cardarrindex":p}:{"class":"mb_pink off"}).text(G));c.find(".selIllustIcon").append($("<div>",{"class":"cardIllustWrap"}).append($("<div>",
H?{"class":"userCharaIcon "+e.attributeId,append:P(e)}:{"class":"offIcon"}),$("<p>",H?{tabindex:"5","data-cardarrindex":p,"class":"mb_pink se_decide"+(F==k?" selected":""),text:G}:{"class":"mb_pink off",text:G})))});$("#cardDetail").attr({"chara-id":d}).off().on("pointerup",".collectionBack",()=>history.back()).on("pointerup","#detailCardImage .cardImg, #detailCardImage .zoomImg",()=>$("#detailCardImage").toggleClass("zoom")).on("pointerup","#detailTab li",M).on("pointerup",".moviePlayBtn",()=>setTimeout(e=>
e.removeClass(),1500,$("#ready").addClass("preNativeFadeIn"))).on("pointerup",".cardIllustWrap .mb_pink",aa).on("pointerup",".miniCharaBtn .mb_pink",ba).empty().append(c);return!0},M=a=>{a=a.currentTarget?$(a.currentTarget).attr("name"):a;$("#cardDetailWrap").removeClass().addClass(a);$("#detailTab li").removeClass("current").filter("[name="+a+"]").addClass("current")},aa=a=>{a.preventDefault();var b=$(a.currentTarget);a=v[$("#cardDetail").attr("chara-id")][b.data("cardarrindex")];const c=a.cardId,
d=a.rank;$(".cardIllustWrap .selected").removeClass("selected");b.addClass("selected");b="frame_"+a.attributeId.toLowerCase()+"_"+d.toLowerCase();$("#detailCardImage .cardImg, #detailCardImage .zoomImg").attr({"data-nativeimgkey":"card_"+c+"_c","data-src":"resource/image_native/card/image/card_"+c+"_c.png"});$("#detailCardImage .cardFrame").attr({["data-nat"+u.substr(1,2)+"ebgkey"]:b,"data-src":"resource/image_native/card/frame/"+b+".png"});$(".illustrator").first().text(a.illustrator);$(".selIllustTitle").first().text("\u2605"+
d.split("RANK_")[1]+" Illustrator:");x()},ba=a=>{a.preventDefault();a=$(a.currentTarget);if(!a.is(".off,.selected")){$(".miniCharaBtn .selected").removeClass("selected");a.addClass("selected");var b=v[$("#cardDetail").attr("chara-id")][a.data("cardarrindex")||0];"chara"==a.data("commandtype")?(a="mini/image/",b="mini_"+b.miniCharaNo+"_d"):(a="card/image/",b="card_"+b.cardId+"_d");$(".discPreview .discWrap img").attr({["data-nat"+u.substr(1,2)+"eimgkey"]:b,"data-src":"resource/image_native/"+a+b+".png"});
x()}},ca=a=>{a.preventDefault();$(".tabBtns .current").removeClass("current");$("#charaWrap").attr({"class":$(a.currentTarget).addClass("current").attr("data-att").toLowerCase()+" commonFrame2"})};$(document).on("pointerdown",".TE",a=>$(a.currentTarget).not(".off,.current,.selected").addClass("touch")).on("pointermove pointerup",".TE",a=>$(a.currentTarget).removeClass("touch")).on("pointerdown","body",a=>setTimeout(b=>b.remove(),700,$("<div>",{"class":"commonEffect",css:{top:a.clientY-128+"px",left:a.clientX-
128+"px"},append:[$("<div>",{"class":"effect01"}),$("<div>",{"class":"effect02"}),$("<div>",{"class":"effect03"})]}).appendTo("body"))).on("keydown","[tabindex]",a=>("Enter"==a.key&&$(a.currentTarget).trigger("pointerup"),!0)).on("contextmenu",a=>(a.preventDefault(),document.documentElement.requestFullscreen().catch(t))).on("DOMContentLoaded",()=>{w(!0);K();$(window).on({resize:()=>z=z?clearTimeout(z):setTimeout(K,500),popstate:V,"error unhandledrejection":D});history.replaceState({page:"mgirls"},
"Magical Girls Gallery");const a=U((document.cookie.match(/(?:^|; )gallery=([^;]*)/)||[0,null])[1],(document.cookie.match(/(?:^|; )adjustments=([^;]*)/)||[0,null])[1]);f.mirror&&$("body").addClass("lm_rorrim");f.limit_height&&$("body").addClass("lm_limit_height");f.fix_titlebug&&E({raw:["{margin-left:8px;}",'::before{content:"[";}','::after{content:"]";}'].map(b=>"#cardDetail #detailCardName .charaName .title"+b)});f.no_file&&$("<a/>",{id:"lm_use_setup",href:"/setup"}).appendTo("body");f.text_case&&
$("body").addClass("lm_to"+f.text_case);f.font?C("font/"+f.font).then(E).catch(t):E({href:"https://fonts.googleapis.com/css?family=Open+Sans:600"});Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(C)).then(b=>{var c=b.pop().data;try{n=JSON.parse([...c].reverse().join(""))}catch(d){D(d)}b.forEach(J);r=JSON.parse(a).data||{};b=$("#charaWrapInner").css({display:"none"});n.chara.data.forEach(Y);x();w(!1);b.css({display:"block"});$("#tabArea .tabBtns li").on("pointerup",ca)}).catch(t)})})
("todestrieb", "LiviaMedeiros");
