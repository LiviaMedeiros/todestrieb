/*! todestrieb: Magical Girls Gallery Â© 2021 LiviaMedeiros */
'use strict';((ba,ca)=>{var D=null,R={},n={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,show_kana:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1},da=null,S=null;const [E,T,K,L]=Array.from({length:4},()=>new Map),U=(a,b=189)=>{a=a.replace(/[^A-Za-z0-9\+\/]/g,"");for(var c=a.length,d=Math.ceil(3*c+1>>2),f=new Uint8Array(d),k,l=0,t=0,q=0;q<c;q++){k=q&3;let u=a.charCodeAt(q);l|=(64<u&&91>u?u-65:96<u&&123>u?u-71:47<u&&58>u?u+4:43===u?62:
47===u?63:0)<<6*(3-k);if(3===k||1===c-q){for(k=0;3>k&&t<d;k++,t++)f[t]=l>>>(16>>>k&24)&255^b;l=0}}return f},x=(a,b)=>{a.innerText=b;return a},m=(a,...b)=>{(a||document.documentElement).classList.add(...b);return a},v=(a,...b)=>{a.classList.remove(...(b.length?b:a.classList));return a},V=(a,b)=>b.some(c=>a.classList.contains(c)),r=document.getElementById.bind(document),A=(a,b={})=>{Object.assign(a.dataset,b);return a},F=(a,b={})=>Object.assign(a,b),M=(a,b)=>{Object.assign(a.style,b);return a},w=(a,
b,c=document)=>c.querySelectorAll(a).forEach(b),g=(a,b=document)=>b.querySelector(a),e=(a="div",{d:b={},c=[],g:d={},a:f=[],h:k={}}={},l=[])=>{(a=F(document.createElement(a),d)).append(...f,...l);return m(A(M(a,k),b),...c)},B=(a,b,c,d=!1,...f)=>{b.forEach(k=>a.addEventListener(k,d?(l,...t)=>{for(let q=l.target;q&&q!=l.currentTarget;q=q.parentNode)if(q.matches(d))return c(l,...t)}:c,...f));return a},W=a=>fetch(new URL("magica/json/"+a+".json",location.origin),{cache:"force-cache"}).then(b=>location.hostname.toLowerCase().startsWith(ba)&&
b.json()),ea=a=>Object.entries(a).forEach(([b,c])=>L.set(b,new URL(URL.createObjectURL(new Blob([U(c,0)],{type:"image/png"}))))),pa=(a,b=!1)=>{a||(n.no_file=!0,a='{"data":{}}');try{R=Object.freeze(JSON.parse(a))}catch(c){return X(c)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(n,("object"===typeof b?b:{})||{},R.adjustments||{});return R},N=a=>document.documentElement.classList.toggle("connecting",a),qa=a=>{a=(new TextDecoder).decode(U(a));try{D=Object.freeze(JSON.parse(a))}catch(b){X(b)}D.chara.forEach(({id:b})=>
E.set(b,D.card.filter(c=>c.charaNo===b)))},Y=(a,b=[],c=2,d=100)=>{a.font&&b.push("@font-face{font-family:'Open Sans';src:url("+URL.createObjectURL(new Blob([U(a.font)],{type:"font/ttf"}))+");}");a.raw&&b.push(...a.raw);a.href&&document.head.append(e("link",{g:{rel:"stylesheet",type:"text/css",href:a.href}}));(new Promise(f=>{const k=setInterval(()=>{var l=document.styleSheets[c];return l&&(clearInterval(k),f(l))},d)})).then(f=>b.forEach(k=>f.insertRule(k,f.cssRules.length)))},fa=()=>{var a=["lm_click",
"lm_touch"];return m(v(document.documentElement,...a),a[+/ios|android/i.test(navigator.userAgent)])},ra=a=>(a=a.state)&&a.chara&&a.card?ha(a):(v(r("mainContent"),"hide"),m(r("cardDetail"),"hide"),ia("status")),C=a=>{m(!1,"lm_warn");F(r("loading"),{title:"An error occured. You can try to reload the page.",onpointerup:()=>location.reload()});return console.warn(a),!1},X=a=>{m(!1,"lm_error");F(g("p",F(r("loading"),{title:"An error occured. You can report about it."})),{onpointerup:()=>location.assign(new URL(ca+
"/"+ba+"/issues","https://github.com"))});return console.error(a),!1},ja=a=>{a.forEach((b,c)=>K.set(c,b));K.forEach((b,c)=>{const d=L.get(b);return d?(w("img[data-nativeimgkey="+c+"]",f=>{F(f,{src:d});delete f.dataset.nativeimgkey;delete f.dataset.src}),w(".lm_ob[data-nativebgkey="+c+"]",f=>{v(M(f,{backgroundImage:"url("+d+")"}),"lm_ob");delete f.dataset.nativeimgkey;delete f.dataset.src})):C(c)})},O=(a=new Map)=>{w("img[data-nativeimgkey]",({dataset:{nativeimgkey:b,src:c}})=>b&&!K.has(b)&&a.set(b,
c));w(".lm_ob[data-nativebgkey]",({dataset:{nativebgkey:b,src:c}})=>b&&!K.has(b)&&a.set(b,c));if([...a.values()].every(L.has.bind(L)))return ja(a);N(!0);Promise.all([...(new Set([...a.keys()].filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>W("card_c_"+b.substr(5,4)))).then(b=>{b.forEach(ea);ja(a);N(!1)}).catch(C)},ka=(a,b)=>n.card_probability?Math.random()<n.card_probability:T.get(a)?.has(b),sa=({attributeId:a,name:b,id:c,title:d,kana:f})=>e("div",{c:["lm_missing","chara","commonFrame4","se_decide",
a],g:{title:b},d:{charaId:c,maxCardRank:0}},[e("div",{c:["nameWrap"]},[e("span",{c:["att",a]}),e("p",{c:["name"],g:{textContent:b}},[e("span",{c:["title"],g:{textContent:d}})]),e("p",{c:["kana"],g:{textContent:f}})]),e("div",{c:["charaIconWrap"]})]),G=(a,b,c="id")=>D[a].find(({[c]:d})=>d===b),z=(a,b)=>({nativeimgkey:a,src:"resource/image_native/"+b+"/"+a+".png"}),Z=(a,b)=>({["nat"+ca.substr(1,2)+"ebgkey"]:a,src:"resource/image_native/"+b+"/"+a+".png"}),ua=async a=>{const b=a.id,c=n.chara_probability?
Math.random()<n.chara_probability:T.get(b)?.size;if(n.hide_missing&&!c)return!1;const d=sa(a);E.get(b).forEach(f=>{const {id:k,rank:l}=f,t=e("div",{c:["userCharaIcon",f.attributeId,l]});if(ka(f.charaNo,k)){const q=+l.split("RANK_")[1];q>+Object.assign(d,{tabIndex:"2"}).dataset.maxCardRank&&A(v(d,"lm_missing"),{maxCardId:k,maxCardRank:q});t.append(...la(f))}else t.append(e("span",{c:["closed"]}));g(".charaIconWrap",d).append(t)});r("charaWrapInner").append(c?B(d,["pointerup"],ta):d)},la=a=>[["att",
"att","attributeId"],["star","star","rank"],["rank","frame","rank"],[!1,"card","id","_f"],["bg","bg","attributeId"]].map(([b,c,d,f=""])=>(d=c+"_"+String(a[d]).toLowerCase()+f,b?e("span",{c:["lm_ob",b],d:Z(d,"card/frame")}):e("img",{g:{alt:""},d:z(d,"card/image")}))),ta=a=>{if(!a.cancelable&&a.isTrusted&&n.fix_scrollbug)return!0;const {charaId:b,maxCardId:c}=a.currentTarget.dataset;a={page:"mgirl",chara:+b,card:+c};history.pushState(a,"Magical Girl \u2116"+b);return ha(a)},ha=({chara:a,card:b})=>{va(G("chara",
a),G("card",b)).then(c=>{!1!==c&&(O(),m(r("mainContent"),"hide"),v(r("cardDetail"),"hide"))}).catch(C)},ma=a=>e("div",{c:["detailWrap"]},[e("p",{c:["name","c_purple"],g:{innerText:a.name}}),e("div",{c:["common_line","lc_beige"]}),e("p",{c:["detail"],g:{innerText:a.shortDescription}})]),ya=(a,b,c)=>{const {id:d,attributeId:f,title:k}=a,{id:l,rank:t,maxPieceSkillId:[q],doppelMagiaId:u,commandType:na}=b;(h=>{m(g("#att",h),f.toLowerCase());x(g(".charaName",h),a.name).append(...(k?[e("span",{c:["title",
"ts_pink"],g:{innerText:k}})]:[]))})(g("#detailCardName",c));var H=z("card_"+l+"_c","card/image");g("#detailCardImage",c).append(e("div",{c:["lm_ob","cardFrame",t,f],d:Z("frame_"+f.toLowerCase()+"_"+t.toLowerCase(),"card/frame")}),e("img",{c:["cardImg","se_tabs"],g:{alt:"",title:"Tap to zoom in"},d:H}),e("img",{c:["zoomImg","se_tabs"],g:{alt:"",title:"Tap to zoom out"},d:H}),e("span",{c:["moviePlayBtn","se_tabs","TE"],g:{title:"Transformation videos are disabled in this version"}}));const oa=+t.split("RANK_")[1],
[P,Q,aa]=["Status","Skill","Illust"].map(h=>g("#chara"+h,c));(h=>{A(g("img",h),z("mini_"+b.miniCharaNo+"_s","mini/image"));m(g("#rare",h),t).append(...Array(oa).fill("span").map(p=>e(p)))})(g("#cardDetailMiniChara",P));(h=>{w(".currentLv,.maxLv",p=>x(p,[1,40,50,60,80,100][+t.split("RANK_")[1]]||1),g("#detailLv",h));x(g(".type>.tdStyle",h),{BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType])})(g(".statusWrap",
P));w("#popupCharaStatus .c_red",(h,p)=>x(h,+b[["hp","attack","defense"][p]]*(1+(n.keep_statbug?3:[0,2,2.2,2.4,2.6,3][+t.split("RANK_")[1]]||1)*{BALANCE:[1,1,1],ATTACK:[.98,1.03,.97],DEFENSE:[.97,.98,1.05],HP:[1.04,.97,.98],ATKDEF:[.99,1.02,1.01],ATKHP:[1.02,1.01,.99],DEFHP:[1.01,.99,1.02]}[b.growthType][p])|0),P);[[".profileWrap>.detail",a.description],[".exProfile1>.tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+oa+" Illustrator"],[".selIllustrator",b.illustrator],
[".selCharacterVoice",a.voiceActor]].forEach(([h,p])=>x(g(h,P),p));[["skill",".connect"],["magia",".magiaDetail"]].map(([h,p])=>{p=g(p,Q);const {groupId:y,name:I,shortDescription:J}=G(h,b[h+"Id"]);A(g("img",p),z("icon_skill_"+y,"art"));x(g(".name",p),I);x(g(".detail",p),J)});g(".commandList",Q).append(...na.map(h=>e("li",{c:[n.all_discs||h]})));g(".discPreview",aa).append(...na.map(h=>e("div",{c:["discWrap",h]},[e("div",{c:["discText"]}),e("img",{d:z("card_"+l+"_d","card/image")})])));q&&(H=G("pieceskill",
q),g(".command",Q).after(e("div",{c:["commonFrame3","connect"]},[e("p",{c:["common_title_frame"],g:{innerText:"EX Skill"}}),e("div",{c:[n.keep_exbug?"flexbox":"flexBox"]}[e("p",{c:["img"]},[e("img",{d:z("icon_skill_"+H.groupId,"art")})]),ma(H)])])));u&&g(".magia",Q).append(e("div",{c:["doppel","doppelDetail"]},[e("div",{c:["flexBox"]},[e("p",{c:["img","doppel"]},[e("img",{d:z("mini_"+b.doppelCharaNo+"_dd","mini/image")}),e("span",{c:["bg"]})]),ma(G("magia",u))])]));E.get(d).forEach((h,p)=>{var y=
h.id;const I=["mb_pink","se_decide"];y===l&&I.push("selected");const J="\u2605"+ +h.rank.split("RANK_")[1];y=ka(d,y);g(".miniCharaBtn",aa).append(x(e("p",y?{c:I,g:{tabIndex:"4"},d:{commandtype:"card",cardarrindex:p}}:{c:["mb_pink","off"]}),J));g(".selIllustIcon",aa).append(e("div",{c:["cardIllustWrap"]},[e("div",y?{c:["userCharaIcon",h.attributeId],a:la(h)}:{c:["offIcon"]}),e("p",y?{c:I,g:{innerText:J,tabIndex:"5"},d:{cardarrindex:p}}:{c:["mb_pink","off"],g:{innerText:J}})]))});[[".collectionBack",
()=>history.back()],["#detailCardImage>img",()=>r("detailCardImage").classList.toggle("zoom")],["#detailTab>li",ia],[".moviePlayBtn",()=>setTimeout(h=>v(h),1500,m(r("ready"),"preNativeFadeIn"))],[".cardIllustWrap>.mb_pink",wa],[".miniCharaBtn>.mb_pink",xa]].forEach(([h,p])=>w(h,y=>B(y,["pointerup"],p),c));return c},va=async(a,b)=>b?r("cardDetail").replaceWith(e("div",{g:{id:"cardDetail"},d:{charaId:a.id}},[ya(a,b,da.cloneNode(!0))])):!1,ia=a=>{const b=a.currentTarget?.dataset?.type??a;m(v(r("cardDetailWrap")),
b);w("#detailTab>li",c=>(c.dataset.type===b?m:v)(c,"current"))},wa=({currentTarget:a})=>{if(!V(a,["off","selected"])){v(g(".cardIllustWrap>.selected"),"selected");var {id:b,rank:c,attributeId:d,illustrator:f}=E.get(+r("cardDetail").dataset.charaId)[+m(a,"selected").dataset.cardarrindex];(k=>{w("img",l=>A(l,z("card_"+b+"_c","card/image")),k);A(m(g(".cardFrame",k),"lm_ob"),Z("frame_"+d.toLowerCase()+"_"+c.toLowerCase(),"card/frame"))})(r("detailCardImage"));x(g(".illustrator"),f);x(g(".selIllustTitle"),
"\u2605"+ +c.split("RANK_")[1]+" Illustrator:");O()}},xa=({currentTarget:a})=>{if(!V(a,["off","selected"])){v(g(".miniCharaBtn>.selected"),"selected");a=m(a,"selected").dataset;var b=E.get(+r("cardDetail").dataset.charaId)[+(a.cardarrindex||0)],c=z(...("chara"===a.commandtype?["mini_"+b.miniCharaNo+"_d","mini/image"]:["card_"+b.id+"_d","card/image"]));w(".discPreview>.discWrap>img",d=>A(d,c));O()}},za=({currentTarget:a})=>{v(g(".tabBtns>.current"),"current");m(v(r("charaWrap")),m(a,"current").dataset.att.toLowerCase(),
"commonFrame2")},Aa=({target:a})=>v(a,"touch"),Ba=a=>void setTimeout(b=>b.remove(),700,(b=>document.body.appendChild(e("div",{c:["commonEffect"],h:{top:b.clientY-128+"px",left:b.clientX-128+"px"}},Array.from({length:3},(c,d)=>e("div",{c:["effect0"+(d+1)]})))))(a)),Ca=()=>{n.mirror&&m(!1,"lm_rorrim");n.limit_height&&m(!1,"lm_limit_height");n.fix_titlebug&&Y({raw:["{margin-left:8px;}",'::before{content:"[";}','::after{content:"]";}'].map(a=>"#detailCardName>.charaName>.title"+a)});n.no_file&&document.body.append(e("a",
{g:{id:"lm_use_setup",href:new URL("setup",location.origin)}}));n.text_case&&m(!1,"lm_to"+n.text_case);n.show_kana&&m(!1,"lm_kana");n.font?W("font/"+n.font).then(Y).catch(C):Y({href:new URL("css?family=Open+Sans:600","https://fonts.googleapis.com")})};return B(document,["DOMContentLoaded"],()=>{N(!0);[[["resize"],()=>S=S?clearTimeout(S):setTimeout(fa,500)],[["popstate"],ra],[["error"],X]].forEach(c=>B(window,...c));fa();[[["pointerdown"],".TE",({target:c})=>V(c,["off","current","selected"])||m(c,
"touch")],[["pointerup","pointermove"],".TE",Aa],[["pointerdown"],"body",Ba],[["keydown"],"[tabIndex]",c=>void("Enter"===c.key&&c.target.dispatchEvent(new PointerEvent("pointerup")))],[["contextmenu"],!1,c=>(c.preventDefault(),document.documentElement.requestFullscreen().catch(C)),!1]].forEach(([c,d,f,k=!0])=>B(document,c,f,d,{passive:k}));history.replaceState({page:"mgirls"},"Magical Girls Gallery");const a=pa(...["gallery","adjustments"].map(c=>document.cookie.match(new RegExp("(?:^|;)\\s*"+c+"\\s*=\\s*([^;]*)"))?.pop()||
null));Ca();const b=M(r("charaWrapInner"),{display:"none"});Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(W)).then(c=>{qa(c.pop().data);c.forEach(ea);Object.entries(a.data).forEach(([d,f])=>T.set(+d,new Set(f.map(Number))));(d=>{da=d.content;d.remove()})(r("tmplCharaDetail"));return Promise.all(D.chara.map(ua))}).then(()=>{O();M(b,{display:"block"});w("#tabArea>.tabBtns>li",c=>B(c,["pointerup"],za));N(!1)}).catch(C)},!1,{once:!0})})
("todestrieb", "LiviaMedeiros");
