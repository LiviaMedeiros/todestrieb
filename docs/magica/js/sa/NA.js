/*! todestrieb: Magical Girls Gallery Â© 2021 LiviaMedeiros */
'use strict';((O,P)=>{var x=null,G={},h={fix_scrollbug:!1,fix_titlebug:!1,keep_statbug:!1,keep_exbug:!1,limit_height:!1,hide_missing:!1,text_case:!1,font:"koruri",no_file:!1,all_discs:!1,mirror:!1},Q=null,H=null;const y=new Map,I=new Map,z=new Map,A=new Map,R=["lm_click","lm_touch"],ca=(a,b=189)=>{a=a.replace(/[^A-Za-z0-9\+\/]/g,"");for(var c=a.length,f=Math.ceil(3*c+1>>2),e=new Uint8Array(f),g,l=0,p=0,r=0;r<c;r++){g=r&3;let m=a.charCodeAt(r);l|=(64<m&&91>m?m-65:96<m&&123>m?m-71:47<m&&58>m?m+4:43===
m?62:47===m?63:0)<<6*(3-g);if(3===g||1===c-r){for(g=0;3>g&&p<f;g++,p++)e[p]=l>>>(16>>>g&24)&255^b;l=0}}return e},J=a=>fetch("/magica/json/"+a+".json",{cache:"force-cache"}).then(b=>location.hostname.toLowerCase().startsWith(O)&&b.json()),S=a=>Object.entries(a).forEach(([b,c])=>A.set(b,URL.createObjectURL(new Blob([ca(c,0)],{type:"image/png"})))),da=(a,b=!1)=>{a||(h.no_file=!0,a='{"data":{}}');try{G=Object.freeze(JSON.parse(a))}catch(c){return K(c)}if(b)try{b=JSON.parse(b)}catch{}Object.assign(h,("object"===
typeof b?b:{})||{},G.adjustments||{});return JSON.stringify(G)},B=a=>$("body").toggleClass(["connecting"],a),ea=a=>{try{x=Object.freeze(JSON.parse([...a].reverse().join("")))}catch(b){K(b)}},L=(a,b=[],c=2,f=100)=>{a.font&&b.push("@font-face{font-family:'Open Sans';src:url('data:font/ttf;base64,"+String(a.font)+"');}");a.raw&&b.push(...a.raw);a.href&&$("<link/>",{rel:"stylesheet",type:"text/css",href:a.href}).appendTo("head");(new Promise(e=>{const g=setInterval(()=>{var l=document.styleSheets[c];
return l&&(clearInterval(g),e(l))},f)})).then(e=>b.forEach(g=>e.insertRule(g,e.cssRules.length)))},T=()=>$("body").removeClass(R).addClass([R[+/ios|android/i.test(navigator.userAgent)]]),fa=a=>(a=a.originalEvent.state)&&a.chara&&a.card?U(a):($("#mainContent").removeClass(["hide"]),$("#cardDetail").addClass(["hide"]),V("status")),t=a=>{$("body").addClass(["lm_warn"]);$("#loading").attr({title:"An error occured. You can try to reload the page."}).on("pointerup",()=>location.reload());return console.warn(a),
!1},K=a=>{$("body").addClass(["lm_error"]);$("#loading").attr({title:"An error occured. You can report about it."}).find("p").on("pointerup",()=>location.assign("https://github.com/"+P+"/"+O+"/issues"));return console.error(a.originalEvent),!1},W=a=>{a.forEach((b,c)=>z.set(c,b));z.forEach((b,c)=>(b=A.get(b))?($("img[data-nativeimgkey="+c+"]").removeAttr("data-nativeimgkey data-src").attr({src:b}),$(".lm_ob[data-nativebgkey="+c+"]").removeClass(["lm_ob"]).removeAttr("data-nativebgkey data-src").css({backgroundImage:"url("+
b+")"})):t(c))},C=()=>{const a=new Map;$("img[data-nativeimgkey]").each((b,{dataset:c})=>(b=c.nativeimgkey)&&!z.has(b)?a.set(b,c.src):!0);$(".lm_ob[data-nativebgkey]").each((b,{dataset:c})=>(b=c.nativebgkey)&&!z.has(b)?a.set(b,c.src):!0);if([...a.values()].every(A.has.bind(A)))return W(a);B(!0);Promise.all([...(new Set([...a.keys()].filter(b=>/^card_\d{5}_c$/.test(b))))].map(b=>J("card_c_"+b.substr(5,4)))).then(b=>{b.forEach(S);W(a);B(!1)}).catch(t)},X=(a,b)=>h.card_probability?Math.random()<h.card_probability:
I.get(a)?.has(b),ha=({attributeId:a,name:b,id:c,title:f,kana:e})=>$("<div>",{"class":"lm_missing chara commonFrame4 se_decide "+a,title:b,data:{charaId:c,maxCardRank:0},append:[$("<div>",{"class":"nameWrap",append:[$("<span>",{"class":"att "+a}),$("<p>",{"class":"name",text:b,append:$("<span>",{"class":"title",text:f})}),$("<p>",{"class":"kana",text:e})]}),$("<div>",{"class":"charaIconWrap"})]}),u=(a,b,c="id")=>x[a].data.find(({[c]:f})=>f==b),q=(a,b)=>({alt:"","data-nativeimgkey":a,"data-src":"resource/image_native/"+
b+"/"+a+".png"}),M=(a,b)=>({["data-nat"+P.substr(1,2)+"ebgkey"]:a,"data-src":"resource/image_native/"+b+"/"+a+".png"}),ja=a=>{const b=h.chara_probability?Math.random()<h.chara_probability:I.get(a.id)?.size;if(h.hide_missing&&!b)return!1;const c=ha(a),f=x.card.data.filter(e=>e.charaNo==a.id);y.set(a.id,f);f.forEach(e=>{var g=e.rank;const l=$("<div>",{"class":"userCharaIcon "+e.attributeId+" "+g});X(e.charaNo,e.cardId)?(g=+g.split("RANK_")[1],g>c.data("maxCardRank")&&c.data({maxCardId:e.cardId,maxCardRank:g}).removeClass(["lm_missing"]),
c.attr({tabindex:"2"}),l.append(Y(e))):l.append($("<span>",{"class":"closed"}));$(".charaIconWrap",c).append(l)});$("#charaWrapInner").append(b?c.on("pointerup",ia):c)},Y=a=>[["att","att","attributeId"],["star","star","rank"],["rank","frame","rank"],[!1,"card","cardId","_f"],["bg","bg","attributeId"]].map(([b,c,f,e=""])=>(f=c+"_"+a[f].toString().toLowerCase()+e,b?$("<span>",{"class":"lm_ob "+b,...M(f,"card/frame")}):$("<img>",q(f,"card/image")))),ia=a=>{if(!a.cancelable&&!a.isTrigger&&h.fix_scrollbug)return!0;
a.preventDefault();const {charaId:b,maxCardId:c}=$(a.currentTarget).data();a={page:"mgirl",chara:b,card:c};history.pushState(a,"Magical Girl \u2116"+b);return U(a)},U=({chara:a,card:b})=>{if(!ka(u("chara",a),u("card",b,"cardId")))return!1;C();$("#mainContent").addClass(["hide"]);$("#cardDetail").removeClass(["hide"])},Z=a=>$("<div>",{"class":"detailWrap",append:[$("<p>",{"class":"name c_purple",text:a.name}),$("<div>",{"class":"common_line lc_beige"}),$("<p>",{"class":"detail",text:a.shortDescription})]}),
ka=(a,b)=>{if(!b)return!1;const c=Q.clone(),{id:f,attributeId:e,title:g}=a,{cardId:l,rank:p,maxPieceSkillId1:r,doppelMagiaId:m}=b,aa=Array.from({length:5},(d,k)=>b["commandType"+(k+1)]);(d=>{$("#att",d).addClass([e.toLowerCase()]);$(".charaName",d).text(a.name).append(g&&$("<span>",{"class":"title ts_pink",text:g}))})($("#detailCardName",c));var v=q("card_"+l+"_c","card/image");$("#detailCardImage",c).append($("<div>",{"class":"lm_ob cardFrame "+p+" "+e,...M("frame_"+e.toLowerCase()+"_"+p.toLowerCase(),
"card/frame")}),$("<img>",{"class":"cardImg se_tabs",title:"Tap to zoom in",...v}),$("<img>",{"class":"zoomImg se_tabs",title:"Tap to zoom out",...v}),$("<span>",{"class":"moviePlayBtn se_tabs TE",title:"Transformation videos are disabled in this version"}));const ba=+p.split("RANK_")[1],[D,E,N]=["Status","Skill","Illust"].map(d=>$("#chara"+d,c));(d=>{$("img",d).attr(q("mini_"+b.miniCharaNo+"_s","mini/image"));$("#rare",d).removeClass().addClass([p]).append(Array(ba).fill("<span>").map(k=>$(k)))})($("#cardDetailMiniChara",
D));(d=>{$(".currentLv,.maxLv",$("#detailLv",d)).text([1,40,50,60,80,100][+p.split("RANK_")[1]]||1);$(".type>.tdStyle",d).text({BALANCE:"Balanced",ATTACK:"Attack",DEFENSE:"Defense",MAGIA:"Magia",HEAL:"Heal",SUPPORT:"Support",ULTIMATE:"Ultimate",CIRCLE_MAGIA:"Cycle Magia"}[b.initialType])})($(".statusWrap",D));(d=>({BALANCE:[1,1,1],ATTACK:[.98,1.03,.97],DEFENSE:[.97,.98,1.05],HP:[1.04,.97,.98],ATKDEF:[.99,1.02,1.01],ATKHP:[1.02,1.01,.99],DEFHP:[1.01,.99,1.02]})[b.growthType].map((k,n)=>d.eq(n).text(+b[["hp",
"attack","defense"][n]]*(1+(h.keep_statbug?3:[0,2,2.2,2.4,2.6,3][+p.split("RANK_")[1]]||1)*k)|0)))($("#popupCharaStatus .c_red",D));[[".profileWrap>.detail",a.description],[".exProfile1>.tdStyle",a.school],[".selCharacterDesign",a.designer],[".selIllustTitle","\u2605"+ba+" Illustrator"],[".selIllustrator",b.illustrator],[".selCharacterVoice",a.voiceActor]].forEach(([d,k])=>$(d,D).text(k));[["skill",".connect"],["magia",".magiaDetail"]].map(([d,k])=>{k=$(k,E);const {groupId:n,name:F,shortDescription:w}=
u(d,b[d+"Id"]);$("img",k).attr(q("icon_skill_"+n,"art"));$(".name",k).text(F);$(".detail",k).text(w)});$(".commandList",E).append(aa.map(d=>$("<li>",{"class":h.all_discs||d})));r&&(v=u("pieceskill",r),$(".command",E).after($("<div>",{"class":"commonFrame3 connect",append:[$("<p>",{"class":"common_title_frame",text:"EX Skill"}),$("<div>",{"class":h.keep_exbug?"flexbox":"flexBox",append:[$("<p>",{"class":"img",append:$("<img>",q("icon_skill_"+v.groupId,"art"))}),Z(v)]})]})));m&&$(".magia",E).append($("<div>",
{"class":"doppel doppelDetail",append:$("<div>",{"class":"flexBox",append:[$("<p>",{"class":"img doppel",append:[$("<img>",q("mini_"+b.doppelCharaNo+"_dd","mini/image")),$("<span>",{"class":"bg"})]}),Z(u("magia",m))]})}));(d=>$(".discPreview",N).append(aa.map(k=>$("<div>",{"class":"discWrap "+k,append:[$("<div>",{"class":"discText"}),d]}).clone())))($("<img>",q("card_"+l+"_d","card/image")));y.get(f).forEach((d,k)=>{var n=d.cardId;const F="mb_pink se_decide"+(n==l?" selected":""),w="\u2605"+ +d.rank.split("RANK_")[1];
n=X(f,n);$(".miniCharaBtn",N).append($("<p>",n?{"class":F,tabindex:"4",data:{commandtype:"card",cardarrindex:k}}:{"class":"mb_pink off"}).text(w));$(".selIllustIcon",N).append($("<div>",{"class":"cardIllustWrap"}).append($("<div>",n?{"class":"userCharaIcon "+d.attributeId,append:Y(d)}:{"class":"offIcon"}),$("<p>",n?{"class":F,text:w,tabindex:"5",data:{cardarrindex:k}}:{"class":"mb_pink off",text:w})))});$("#cardDetail").data({charaId:f}).off().on("pointerup",".collectionBack",()=>history.back()).on("pointerup",
"#detailCardImage>img",()=>$("#detailCardImage").toggleClass("zoom")).on("pointerup","#detailTab>li",V).on("pointerup",".moviePlayBtn",()=>setTimeout(d=>d.removeClass(),1500,$("#ready").addClass(["preNativeFadeIn"]))).on("pointerup",".cardIllustWrap>.mb_pink",la).on("pointerup",".miniCharaBtn>.mb_pink",ma).empty().append(c);return!0},V=a=>{a=a.currentTarget?$(a.currentTarget).attr("data-type"):a;$("#cardDetailWrap").removeClass().addClass([a]);$("#detailTab>li").removeClass(["current"]).filter("[data-type="+
a+"]").addClass(["current"])},la=a=>{a.preventDefault();$(".cardIllustWrap>.selected").removeClass(["selected"]);const {cardId:b,rank:c,attributeId:f,illustrator:e}=y.get($("#cardDetail").data("charaId"))[$(a.currentTarget).addClass(["selected"]).data("cardarrindex")];a=$("#detailCardImage");$("img",a).attr(q("card_"+b+"_c","card/image"));$(".cardFrame",a).addClass(["lm_ob"]).attr(M("frame_"+f.toLowerCase()+"_"+c.toLowerCase(),"card/frame"));$(".illustrator").text(e);$(".selIllustTitle").text("\u2605"+
+c.split("RANK_")[1]+" Illustrator:");C()},ma=a=>{a.preventDefault();a=$(a.currentTarget);if(!a.is(".off,.selected")){$(".miniCharaBtn>.selected").removeClass("selected");a=a.addClass(["selected"]).data();var b=y.get($("#cardDetail").data("charaId"))[a.cardarrindex||0];$(".discPreview>.discWrap>img").attr(q(...("chara"==a.commandtype?["mini_"+b.miniCharaNo+"_d","mini/image"]:["card_"+b.cardId+"_d","card/image"])));C()}},na=a=>{a.preventDefault();$(".tabBtns>.current").removeClass(["current"]);$("#charaWrap").removeClass().addClass([$(a.currentTarget).addClass(["current"]).data("att").toLowerCase(),
"commonFrame2"])};$(document).on("pointerdown",".TE",a=>$(a.currentTarget).not(".off,.current,.selected").addClass(["touch"])).on("pointermove pointerup",".TE",a=>$(a.currentTarget).removeClass(["touch"])).on("pointerdown","body",a=>setTimeout(b=>b.remove(),700,$("<div>",{"class":"commonEffect",css:{top:a.clientY-128+"px",left:a.clientX-128+"px"},append:[$("<div>",{"class":"effect01"}),$("<div>",{"class":"effect02"}),$("<div>",{"class":"effect03"})]}).appendTo("body"))).on("keydown","[tabindex]",
a=>("Enter"==a.key&&$(a.currentTarget).trigger("pointerup"),!0)).on("contextmenu",a=>(a.preventDefault(),document.documentElement.requestFullscreen().catch(t))).one("DOMContentLoaded",()=>{B(!0);T();$(window).on({resize:()=>H=H?clearTimeout(H):setTimeout(T,500),popstate:fa,"error unhandledrejection":K});history.replaceState({page:"mgirls"},"Magical Girls Gallery");const a=da(...[/(?:^|; )gallery=([^;]*)/,/(?:^|; )adjustments=([^;]*)/].map(b=>(document.cookie.match(b)||[0,null])[1]));h.mirror&&$("body").addClass(["lm_rorrim"]);
h.limit_height&&$("body").addClass(["lm_limit_height"]);h.fix_titlebug&&L({raw:["{margin-left:8px;}",'::before{content:"[";}','::after{content:"]";}'].map(b=>"#detailCardName>.charaName>.title"+b)});h.no_file&&$("<a/>",{id:"lm_use_setup",href:"/setup"}).appendTo("body");h.text_case&&$("body").addClass(["lm_to"+h.text_case]);h.font?J("font/"+h.font).then(L).catch(t):L({href:"https://fonts.googleapis.com/css?family=Open+Sans:600"});Promise.all("art card_d card_f frame mini_d mini_dd mini_s mirrors".split(" ").map(J)).then(b=>
{ea(b.pop().data);b.forEach(S);Object.entries(JSON.parse(a).data).forEach(([c,f])=>I.set(c,new Set(f)));b=$("#charaWrapInner").css({display:"none"});Q=$("#tmplCharaDetail").detach().removeAttr("id style");x.chara.data.forEach(ja);C();B(!1);b.css({display:"block"});$("#tabArea>.tabBtns>li").on("pointerup",na)}).catch(t)})})
("todestrieb", "LiviaMedeiros");
